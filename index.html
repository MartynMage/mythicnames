<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Name Generator | Free D&D, Elf, Dwarf & Character Names | MythicNames</title>
    <meta name="description" content="Free fantasy name generator with backstory creator, party generator, and world builder. Generate unique names for D&D characters, elves, dwarves, orcs, places, kingdoms, taverns & more. Includes pronunciation guides, meanings, and full character backstories.">
    <meta name="keywords" content="fantasy name generator, dnd name generator, character name generator, party generator, world builder, elf name generator, dwarf name generator, orc names, tiefling names, dragonborn names">
    <meta name="author" content="MythicNames">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://mythicnames.io/">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#d4a857">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mythicnames.io/">
    <meta property="og:title" content="Fantasy Name Generator | Free D&D & Character Names with Backstories">
    <meta property="og:description" content="Generate unique fantasy names with party generator, world builder, and character backstories.">
    <meta property="og:image" content="https://mythicnames.io/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Fantasy Name Generator | MythicNames">
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"WebApplication","name":"MythicNames Fantasy Name Generator","description":"Free fantasy name generator with party generator, world builder, and backstory creator.","url":"https://mythicnames.io","applicationCategory":"UtilitiesApplication","offers":{"@type":"Offer","price":"0","priceCurrency":"USD"}}</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Pro:ital,wght@0,400;0,500;1,400&display=swap" rel="stylesheet">
    <style>
        :root{--bg-deep:#0d0b0e;--bg-parchment:#1a1714;--bg-card:#211d19;--border-subtle:#3d352c;--border-glow:#8b7355;--accent-gold:#d4a857;--accent-amber:#e8c47c;--accent-ember:#c45d3e;--accent-blue:#7da8e8;--accent-purple:#b48be0;--accent-green:#6db87d;--accent-red:#e85d5d;--text-primary:#f5efe6;--text-secondary:#c4b8a8;--text-faded:#8a7d6d;--shadow-gold:rgba(212,168,87,0.15)}
        [data-theme="light"]{--bg-deep:#f5f0e6;--bg-parchment:#ebe4d4;--bg-card:#ffffff;--border-subtle:#d4c9b8;--border-glow:#8b7355;--text-primary:#2d2418;--text-secondary:#5c4d3d;--text-faded:#8a7d6d;--shadow-gold:rgba(212,168,87,0.25)}
        [data-theme="light"] body::before{opacity:0.02}
        [data-theme="light"] .ambient-glow{opacity:0.12}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Crimson Pro',Georgia,serif;background:var(--bg-deep);color:var(--text-primary);min-height:100vh;line-height:1.6}
        body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");opacity:0.03;pointer-events:none;z-index:0}
        .ambient-glow{position:fixed;width:800px;height:800px;border-radius:50%;filter:blur(200px);opacity:0.07;pointer-events:none;z-index:0;animation:glowPulse 8s ease-in-out infinite}
        .glow-1{top:-400px;left:50%;transform:translateX(-50%);background:var(--accent-gold);animation-delay:0s}
        .glow-2{bottom:-400px;right:-200px;background:var(--accent-ember);animation-delay:2s}
        .glow-3{top:30%;left:-300px;background:var(--accent-purple);width:600px;height:600px;animation-delay:4s}
        .glow-4{bottom:20%;right:-250px;background:var(--accent-blue);width:500px;height:500px;animation-delay:6s}
        .glow-5{top:60%;left:60%;background:var(--accent-gold);width:400px;height:400px;opacity:0.04;animation-delay:3s}
        @keyframes glowPulse{0%,100%{opacity:0.05;transform:scale(1)}50%{opacity:0.1;transform:scale(1.1)}}
        .particles{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;overflow:hidden}
        .particle{position:absolute;width:4px;height:4px;background:var(--accent-gold);border-radius:50%;opacity:0.3;animation:floatParticle 15s infinite linear}
        .particle:nth-child(2){left:10%;animation-delay:-2s;animation-duration:18s}
        .particle:nth-child(3){left:20%;animation-delay:-4s;animation-duration:14s}
        .particle:nth-child(4){left:30%;animation-delay:-6s;animation-duration:20s}
        .particle:nth-child(5){left:40%;animation-delay:-8s;animation-duration:16s}
        .particle:nth-child(6){left:50%;animation-delay:-10s;animation-duration:19s}
        .particle:nth-child(7){left:60%;animation-delay:-12s;animation-duration:13s}
        .particle:nth-child(8){left:70%;animation-delay:-14s;animation-duration:17s}
        .particle:nth-child(9){left:80%;animation-delay:-3s;animation-duration:21s}
        .particle:nth-child(10){left:90%;animation-delay:-7s;animation-duration:15s}
        @keyframes floatParticle{0%{transform:translateY(100vh) rotate(0deg);opacity:0}10%{opacity:0.4}90%{opacity:0.4}100%{transform:translateY(-100vh) rotate(720deg);opacity:0}}
        /* Theme Toggle */
        .theme-toggle{position:absolute;top:1rem;right:1rem;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:50%;width:42px;height:42px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;z-index:10}
        .theme-toggle:hover{border-color:var(--accent-gold);transform:scale(1.1)}
        .theme-toggle svg{width:20px;height:20px;color:var(--accent-gold);transition:transform 0.3s}
        .theme-toggle:hover svg{transform:rotate(20deg)}
        .theme-toggle .sun-icon{display:none}
        .theme-toggle .moon-icon{display:block}
        [data-theme="light"] .theme-toggle .sun-icon{display:block}
        [data-theme="light"] .theme-toggle .moon-icon{display:none}
        .container{position:relative;z-index:1;max-width:900px;margin:0 auto;padding:1.5rem 1.5rem 4rem}
        header{text-align:center;padding:1.5rem 0}
        .logo-wrapper{display:flex;align-items:center;justify-content:center;gap:0.75rem;margin-bottom:0.5rem}
        .logo-icon{width:56px;height:56px;animation:float 3s ease-in-out infinite;filter:drop-shadow(0 0 10px rgba(212,168,87,0.5))}
        @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
        .logo{font-family:'Cinzel',serif;font-size:clamp(1.8rem,6vw,2.5rem);font-weight:700;color:var(--accent-gold);letter-spacing:0.08em;text-shadow:0 0 40px var(--shadow-gold)}
        .tagline{font-size:1.1rem;color:var(--text-secondary);font-style:italic}
        .site-nav{display:flex;justify-content:center;gap:1.5rem;margin-top:1rem;flex-wrap:wrap}
        .site-nav a{font-family:'Cinzel',serif;font-size:0.85rem;color:var(--text-secondary);text-decoration:none;transition:color 0.2s}
        .site-nav a:hover,.site-nav a.active{color:var(--accent-gold)}
        .intro-section{text-align:center;margin-bottom:1.25rem}
        .intro-section p{color:var(--text-secondary);font-size:1.05rem;max-width:600px;margin:0 auto;line-height:1.6}
        .tab-nav{display:flex;gap:0.35rem;margin-bottom:1.25rem;flex-wrap:wrap;justify-content:center}
        .tab-btn{font-family:'Cinzel',serif;font-size:0.8rem;padding:0.5rem 0.85rem;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:6px;color:var(--text-secondary);cursor:pointer;transition:all 0.2s;position:relative}
        .tab-btn:hover{border-color:var(--border-glow);color:var(--text-primary)}
        .tab-btn.active{background:linear-gradient(135deg,var(--accent-gold),var(--accent-amber));color:var(--bg-deep);border-color:var(--accent-gold)}
        .tab-btn .badge{position:absolute;top:-6px;right:-6px;background:var(--accent-ember);color:white;font-size:0.6rem;padding:2px 5px;border-radius:10px}
        .tab-content{display:none;animation:fadeIn 0.3s ease-out}
        .tab-content.active{display:block}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        @keyframes slideIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}
        @keyframes popIn{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}
        @keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
        .controls-panel{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px;padding:1.25rem;margin-bottom:1.25rem}
        #characterContainer{display:block;width:100%}
        .control-row{display:grid;grid-template-columns:repeat(2,1fr);gap:0.75rem;margin-bottom:0.75rem}
        .control-row.three-col{grid-template-columns:repeat(3,1fr)}
        .control-row.four-col{grid-template-columns:repeat(4,1fr)}
        .control-group{display:flex;flex-direction:column;gap:0.4rem}
        .control-group.full-width{grid-column:1/-1}
        label{font-family:'Cinzel',serif;font-size:0.7rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.1em;display:flex;align-items:center;gap:0.4rem}
        .tooltip-icon{display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;background:var(--border-subtle);border-radius:50%;font-size:0.6rem;color:var(--text-secondary);cursor:help;margin-left:0.3rem;position:relative;font-style:normal;font-family:serif}
        .tooltip-icon::after{content:attr(data-tip);position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);background:var(--bg-card);border:1px solid var(--accent-gold);color:var(--text-primary);padding:0.5rem 0.75rem;border-radius:6px;font-size:0.8rem;font-family:'Crimson Pro',serif;white-space:nowrap;opacity:0;visibility:hidden;transition:all 0.2s;z-index:100;font-weight:normal;text-transform:none;letter-spacing:normal;pointer-events:none}
        .tooltip-icon:hover::after{opacity:1;visibility:visible}
        .tooltip-icon::before{content:'';position:absolute;bottom:calc(100% + 2px);left:50%;transform:translateX(-50%);border:6px solid transparent;border-top-color:var(--accent-gold);opacity:0;visibility:hidden;transition:all 0.2s}
        .tooltip-icon:hover::before{opacity:1;visibility:visible}
        select,input[type="text"]{font-family:'Crimson Pro',serif;font-size:1rem;padding:0.6rem 0.8rem;background:var(--bg-parchment);border:1px solid var(--border-subtle);border-radius:6px;color:var(--text-primary);width:100%;transition:all 0.2s}
        select:focus,input:focus{outline:none;border-color:var(--accent-gold);box-shadow:0 0 0 3px var(--shadow-gold)}
        select{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%239a8b78' d='M6 8L1 3h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 0.75rem center;padding-right:2rem}
        .btn-row{display:flex;gap:0.6rem;margin-top:0.5rem}
        .generate-btn{font-family:'Cinzel',serif;font-size:0.95rem;font-weight:600;flex:1;padding:0.9rem 1.25rem;background:linear-gradient(135deg,var(--accent-gold),var(--accent-amber));color:var(--bg-deep);border:none;border-radius:6px;cursor:pointer;text-transform:uppercase;letter-spacing:0.08em;transition:all 0.2s;position:relative;overflow:hidden}
        .generate-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 8px 25px var(--shadow-gold)}
        .generate-btn:disabled{opacity:0.6;cursor:not-allowed}
        .generate-btn.loading::after{content:'';position:absolute;top:0;left:-200%;width:200%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmer 1.5s infinite}
        .secondary-btn{font-family:'Cinzel',serif;font-size:0.8rem;padding:0.9rem 1rem;background:var(--bg-parchment);border:1px solid var(--border-subtle);border-radius:6px;color:var(--text-secondary);cursor:pointer;transition:all 0.2s;white-space:nowrap;display:flex;align-items:center;gap:0.4rem}
        .secondary-btn:hover{border-color:var(--accent-gold);color:var(--accent-gold)}
        .secondary-btn svg{width:14px;height:14px}
        .results-section{margin-top:1.25rem}
        .results-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.75rem;flex-wrap:wrap;gap:0.5rem}
        .results-title{font-family:'Cinzel',serif;font-size:0.9rem;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.1em}
        .results-actions{display:flex;gap:0.5rem;flex-wrap:wrap}
        /* Comparison Mode */
        .compare-toggle{font-family:'Cinzel',serif;font-size:0.75rem;padding:0.5rem 0.75rem;background:var(--bg-parchment);border:1px solid var(--border-subtle);border-radius:5px;color:var(--text-secondary);cursor:pointer;transition:all 0.2s}
        .compare-toggle:hover,.compare-toggle.active{border-color:var(--accent-gold);color:var(--accent-gold)}
        .compare-toggle.active{background:var(--accent-gold);color:var(--bg-deep)}
        .compare-bar{display:none;background:var(--bg-card);border:1px solid var(--accent-gold);border-radius:8px;padding:1rem;margin-bottom:1rem;animation:slideIn 0.3s}
        .compare-bar.show{display:block}
        .compare-bar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.75rem}
        .compare-bar-title{font-family:'Cinzel',serif;font-size:0.9rem;color:var(--accent-gold)}
        .compare-bar-actions{display:flex;gap:0.5rem}
        .compare-items{display:flex;gap:0.5rem;flex-wrap:wrap}
        .compare-chip{display:flex;align-items:center;gap:0.4rem;padding:0.4rem 0.75rem;background:var(--bg-parchment);border:1px solid var(--border-subtle);border-radius:20px;font-size:0.85rem;color:var(--text-primary)}
        .compare-chip button{background:none;border:none;color:var(--text-faded);cursor:pointer;padding:0;line-height:1}
        .compare-chip button:hover{color:var(--accent-red)}
        .name-item.compare-mode{cursor:pointer}
        .name-item.compare-mode:hover{border-color:var(--accent-gold)}
        .name-item.compare-selected{border-color:var(--accent-gold);background:rgba(212,168,87,0.1)}
        .name-item.compare-selected::before{content:'‚úì';position:absolute;top:0.5rem;right:0.5rem;width:20px;height:20px;background:var(--accent-gold);color:var(--bg-deep);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:0.7rem;font-weight:bold}
        .name-item{position:relative}
        /* Rarity Score */
        .rarity-badge{display:inline-flex;align-items:center;gap:0.3rem;padding:0.2rem 0.5rem;border-radius:12px;font-size:0.7rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em}
        .rarity-common{background:rgba(138,125,109,0.2);color:var(--text-faded)}
        .rarity-uncommon{background:rgba(109,184,125,0.2);color:var(--accent-green)}
        .rarity-rare{background:rgba(125,168,232,0.2);color:var(--accent-blue)}
        .rarity-epic{background:rgba(180,139,224,0.2);color:var(--accent-purple)}
        .rarity-legendary{background:rgba(212,168,87,0.2);color:var(--accent-gold)}
        .names-list{display:flex;flex-direction:column;gap:0.6rem}
        .name-item{display:flex;flex-direction:column;padding:0.75rem 0.9rem;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:6px;transition:all 0.2s;animation:slideIn 0.3s ease-out backwards}
        .name-item:hover{border-color:var(--border-glow);background:rgba(212,168,87,0.05)}
        .name-row{display:flex;justify-content:space-between;align-items:center;gap:0.5rem}
        .name-main{display:flex;align-items:baseline;gap:0.75rem;flex-wrap:wrap;flex:1;min-width:0}
        .name-text{font-family:'Cinzel',serif;font-size:1.1rem;color:var(--text-primary);letter-spacing:0.02em}
        .name-pronunciation{font-size:0.85rem;color:var(--accent-blue);font-style:italic;cursor:pointer;display:flex;align-items:center;gap:0.3rem}
        .name-pronunciation:hover{color:var(--accent-amber)}
        .name-pronunciation svg{width:12px;height:12px}
        .name-meaning{font-size:0.85rem;color:var(--accent-purple)}
        .name-actions{display:flex;gap:0.3rem;flex-shrink:0}
        .name-preview{margin-top:0.6rem;padding-top:0.6rem;border-top:1px solid var(--border-subtle)}
        .name-preview-text{font-size:0.95rem;color:var(--text-secondary);line-height:1.6;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .name-expand{display:inline-flex;align-items:center;gap:0.3rem;margin-top:0.5rem;font-size:0.75rem;color:var(--accent-gold);cursor:pointer;background:none;border:none;padding:0;font-family:'Cinzel',serif;text-transform:uppercase;letter-spacing:0.05em}
        .name-expand:hover{color:var(--accent-amber);text-decoration:underline}
        .copy-btn,.action-btn{display:flex;align-items:center;justify-content:center;width:32px;height:32px;background:transparent;border:1px solid var(--border-subtle);border-radius:5px;color:var(--text-secondary);cursor:pointer;transition:all 0.2s}
        .share-card-btn{display:flex;align-items:center;gap:0.3rem;background:var(--bg-parchment);border:1px solid var(--border-glow);padding:0.4rem 0.65rem;cursor:pointer;color:var(--accent-gold);font-size:0.7rem;font-weight:600;border-radius:5px;transition:all 0.2s;font-family:'Cinzel',serif;white-space:nowrap}
        .share-card-btn:hover{background:rgba(212,168,87,0.15);border-color:var(--accent-gold)}
        .copy-btn:hover{background:var(--accent-gold);border-color:var(--accent-gold);color:var(--bg-deep)}
        .copy-btn.copied{background:var(--accent-green);border-color:var(--accent-green);color:white}
        .action-btn:hover{border-color:var(--accent-gold);color:var(--accent-gold)}
        .action-btn.active,.action-btn.favorited{background:var(--accent-ember);border-color:var(--accent-ember);color:white}
        .copy-btn svg,.action-btn svg{width:14px;height:14px}
        /* History Panel */
        .history-panel{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px;margin-top:1rem;overflow:hidden}
        #tab-history .history-header{display:flex;justify-content:space-between;align-items:center;gap:1rem;margin-bottom:1rem;flex-wrap:wrap}
        .history-header h3{font-family:'Cinzel',serif;font-size:0.85rem;color:var(--text-secondary);display:flex;align-items:center;gap:0.5rem}
        .history-toggle{color:var(--accent-gold);transition:transform 0.2s}
        .history-panel.open .history-toggle{transform:rotate(180deg)}
        .history-content{max-height:0;overflow:hidden;transition:max-height 0.3s}
        .history-panel.open .history-content{max-height:300px;overflow-y:auto}
        .history-list{padding:0.5rem}
        .history-item{display:flex;justify-content:space-between;align-items:center;padding:0.4rem 0.6rem;border-radius:4px;font-size:0.9rem;color:var(--text-secondary)}
        .history-item:hover{background:var(--bg-parchment)}
        .history-item span{font-family:'Cinzel',serif;color:var(--text-primary)}
        .history-clear{font-size:0.75rem;color:var(--accent-ember);cursor:pointer;background:none;border:none}
        .history-item{display:flex;justify-content:space-between;align-items:center}
        .history-item .name-row{flex:1}
        .history-item .copy-btn{flex-shrink:0}
        .danger-btn{border-color:var(--accent-red)!important;color:var(--accent-red)!important}
        .danger-btn:hover{background:var(--accent-red)!important;color:white!important}
        /* Party Generator */
        .party-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem;margin-top:1rem}
        .party-member{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px;padding:1rem;animation:popIn 0.3s ease-out backwards;position:relative;cursor:pointer;transition:all 0.2s}
        .party-member:hover{border-color:var(--accent-gold);transform:translateY(-2px)}
        .party-member::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:8px 8px 0 0}
        .party-member.warrior::before{background:var(--accent-ember)}
        .party-member.mage::before{background:var(--accent-purple)}
        .party-member.rogue::before{background:var(--accent-green)}
        .party-member.cleric::before{background:var(--accent-gold)}
        .party-member.ranger::before{background:var(--accent-blue)}
        .party-member.barbarian::before{background:#c45d3e}
        .party-member.paladin::before{background:#e8c47c}
        .party-member.bard::before{background:#b48be0}
        .party-member.druid::before{background:#6db87d}
        .party-member.monk::before{background:#7da8e8}
        .party-member.warlock::before{background:#8b3a8b}
        .party-member.sorcerer::before{background:#e85d5d}
        .party-member-header{display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem}
        .party-member-header .portrait-small{width:32px;height:32px;flex-shrink:0}
        .party-member-role{font-size:0.7rem;color:var(--text-faded);text-transform:uppercase;letter-spacing:0.1em}
        .party-member-name{font-family:'Cinzel',serif;font-size:1.1rem;color:var(--text-primary);margin-bottom:0.25rem}
        .party-member-info{font-size:0.85rem;color:var(--text-secondary)}
        .party-member-preview{font-size:0.8rem;color:var(--text-faded);margin-top:0.75rem;line-height:1.5;font-style:italic}
        .party-member-actions{display:flex;align-items:center;gap:0.5rem;margin-top:0.5rem}
        .party-card-btn{background:var(--bg-parchment);border:1px solid var(--border-subtle);border-radius:4px;padding:0.25rem 0.5rem;font-size:0.8rem;cursor:pointer;transition:all 0.2s}
        .party-card-btn:hover{border-color:var(--accent-gold);background:rgba(212,168,87,0.1)}
        .party-read-more{background:none;border:none;color:var(--accent-gold);font-size:0.8rem;padding:0;cursor:pointer}
        .party-read-more:hover{text-decoration:underline}
        .party-relationships{margin-top:1.5rem;padding:1rem;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px}
        .party-relationships h3{font-family:'Cinzel',serif;font-size:1rem;color:var(--accent-gold);margin-bottom:0.75rem}
        .relationship-item{display:flex;align-items:center;gap:0.5rem;padding:0.5rem 0;border-bottom:1px solid var(--border-subtle);font-size:0.9rem;color:var(--text-secondary)}
        .relationship-item:last-child{border-bottom:none}
        .relationship-type{color:var(--accent-amber);font-style:italic}
        /* World Builder */
        .world-container{display:grid;gap:1rem}
        .world-section{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px;padding:1rem}
        .world-section h3{font-family:'Cinzel',serif;font-size:1rem;color:var(--accent-gold);margin-bottom:0.75rem;display:flex;align-items:center;gap:0.5rem}
        .world-kingdom{text-align:center;padding:1.5rem;background:linear-gradient(135deg,var(--bg-parchment),var(--bg-card));border-radius:8px;margin-bottom:1rem}
        .world-kingdom-name{font-family:'Cinzel',serif;font-size:1.5rem;color:var(--accent-gold);margin-bottom:0.25rem}
        .world-kingdom-type{color:var(--text-secondary);font-style:italic}
        .world-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:0.75rem}
        .world-item{background:var(--bg-parchment);padding:0.75rem;border-radius:6px;border-left:3px solid var(--accent-gold)}
        .world-item-name{font-family:'Cinzel',serif;font-size:0.95rem;color:var(--text-primary)}
        .world-item-desc{font-size:0.8rem;color:var(--text-secondary);margin-top:0.25rem}
        /* Character Card */
        .character-card{background:var(--bg-card);border:1px solid var(--accent-gold);border-radius:10px;padding:1.35rem;margin-top:1.25rem;animation:popIn 0.3s ease-out;display:block;width:100%;box-sizing:border-box}
        .character-card h3{font-family:'Cinzel',serif;font-size:1.35rem;color:var(--accent-gold);margin-bottom:0.25rem;text-align:center;width:100%}
        .character-subtitle{font-size:1rem;color:var(--accent-amber);margin-bottom:0.85rem;text-align:center;width:100%}
        .character-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:0.65rem;margin-bottom:0.85rem;width:100%}
        .stat-item{background:var(--bg-parchment);padding:0.5rem 0.7rem;border-radius:5px;min-width:0;overflow:hidden}
        .stat-label{font-size:0.65rem;color:var(--text-faded);text-transform:uppercase;letter-spacing:0.1em;display:block}
        .stat-value{font-family:'Cinzel',serif;font-size:0.95rem;color:var(--text-primary);display:block;word-wrap:break-word;overflow-wrap:break-word}
        .character-backstory{background:var(--bg-parchment);padding:1.1rem;border-radius:6px;border-left:3px solid var(--accent-gold);max-height:400px;overflow-y:auto;width:100%;box-sizing:border-box}
        .character-backstory p{font-size:1rem;color:var(--text-secondary);line-height:1.75;margin-bottom:0.85rem;white-space:normal;word-wrap:break-word;overflow-wrap:break-word;width:100%}
        .character-backstory p:last-child{margin-bottom:0}
        .character-actions{display:flex;gap:0.6rem;margin-top:1rem;flex-wrap:wrap}
        /* Share buttons */
        .share-buttons{display:flex;gap:0.5rem;margin-top:0.75rem}
        .share-btn{display:flex;align-items:center;gap:0.4rem;padding:0.5rem 0.75rem;background:var(--bg-parchment);border:1px solid var(--border-subtle);border-radius:5px;color:var(--text-secondary);cursor:pointer;font-size:0.8rem;transition:all 0.2s}
        .share-btn:hover{border-color:var(--accent-gold);color:var(--accent-gold)}
        .share-btn.twitter:hover{border-color:#1da1f2;color:#1da1f2}
        .share-btn.reddit:hover{border-color:#ff4500;color:#ff4500}
        .share-btn svg{width:14px;height:14px}
        /* Race/Pack grids */
        .pack-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:0.9rem;margin-top:0.9rem}
        .pack-card{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px;padding:1rem;cursor:pointer;transition:all 0.2s}
        .pack-card:hover{border-color:var(--accent-gold);transform:translateY(-2px)}
        .pack-icon{font-size:1.85rem;margin-bottom:0.45rem}
        .pack-name{font-family:'Cinzel',serif;font-size:0.95rem;color:var(--text-primary);margin-bottom:0.25rem}
        .pack-desc{font-size:0.85rem;color:var(--text-secondary)}
        .race-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:0.6rem;margin-top:0.9rem}
        .race-card{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px;padding:0.75rem;text-align:center;cursor:pointer;transition:all 0.2s}
        .race-card:hover,.race-card.active{border-color:var(--accent-gold);background:rgba(212,168,87,0.08)}
        .race-icon{font-size:1.5rem;margin-bottom:0.3rem}
        .race-name{font-family:'Cinzel',serif;font-size:0.8rem;color:var(--text-primary)}
        .info-box{background:rgba(125,168,232,0.12);border:1px solid rgba(125,168,232,0.35);border-radius:6px;padding:0.75rem 1rem;margin-bottom:0.9rem;font-size:0.9rem;color:var(--accent-blue)}
        .empty-state{text-align:center;padding:2.5rem 1.5rem;color:var(--text-faded)}
        .empty-icon{font-size:2.25rem;margin-bottom:0.6rem;opacity:0.5}
        .empty-state p{font-size:1rem;font-style:italic}
        /* Modal */
        .toast{position:fixed;bottom:1.5rem;left:50%;transform:translateX(-50%) translateY(100px);background:var(--bg-card);border:1px solid var(--accent-gold);padding:0.6rem 1.1rem;border-radius:6px;color:var(--accent-amber);font-size:0.85rem;opacity:0;transition:all 0.3s;z-index:100}
        .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
        .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);z-index:200;align-items:center;justify-content:center;padding:1rem}
        .modal-overlay.show{display:flex}
        .modal{background:var(--bg-card);border:1px solid var(--accent-gold);border-radius:12px;max-width:650px;width:100%;max-height:85vh;overflow:hidden;display:flex;flex-direction:column;animation:popIn 0.2s ease-out}
        .modal-header{display:flex;justify-content:space-between;align-items:center;padding:1.1rem 1.35rem;border-bottom:1px solid var(--border-subtle)}
        .modal-title{font-family:'Cinzel',serif;font-size:1.2rem;color:var(--accent-gold);display:flex;align-items:center;gap:0.75rem}
        .portrait-small{width:42px;height:42px;border-radius:50%;border:2px solid var(--accent-gold);overflow:hidden;flex-shrink:0;box-shadow:0 0 12px var(--shadow-gold)}
        .portrait-small svg{width:100%;height:100%}
        .modal-close{background:none;border:none;color:var(--text-secondary);font-size:1.75rem;cursor:pointer;line-height:1}
        .modal-close:hover{color:var(--text-primary)}
        .modal-body{padding:1.35rem;overflow-y:auto;flex:1}
        .modal-body p{font-size:1rem;color:var(--text-secondary);line-height:1.75;margin-bottom:0.85rem}
        .modal-body p:last-child{margin-bottom:0}
        .modal-stats{display:grid;grid-template-columns:repeat(2,1fr);gap:0.6rem;margin-bottom:1.1rem}
        .modal-stat{background:var(--bg-parchment);padding:0.5rem 0.7rem;border-radius:5px}
        .modal-stat-label{font-size:0.65rem;color:var(--text-faded);text-transform:uppercase;letter-spacing:0.1em}
        .modal-stat-value{font-family:'Cinzel',serif;font-size:0.95rem;color:var(--text-primary)}
        .modal-actions{display:flex;gap:0.75rem;padding:1.1rem 1.35rem;border-top:1px solid var(--border-subtle);flex-wrap:wrap}
        /* Campaign Manager */
        .campaign-card{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px;padding:1rem;margin-bottom:0.75rem}
        .campaign-card.active{border-color:var(--accent-gold)}
        .campaign-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.75rem}
        .campaign-name{font-family:'Cinzel',serif;font-size:1.1rem;color:var(--accent-gold)}
        .campaign-meta{font-size:0.8rem;color:var(--text-faded)}
        .campaign-actions{display:flex;gap:0.5rem}
        .campaign-content{display:grid;grid-template-columns:repeat(3,1fr);gap:0.5rem}
        .campaign-section{background:var(--bg-parchment);padding:0.6rem;border-radius:6px}
        .campaign-section-title{font-size:0.7rem;color:var(--text-faded);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.3rem}
        .campaign-section-count{font-family:'Cinzel',serif;font-size:1.2rem;color:var(--text-primary)}
        .campaign-items{margin-top:0.75rem;padding-top:0.75rem;border-top:1px solid var(--border-subtle)}
        .campaign-item{display:flex;justify-content:space-between;align-items:center;padding:0.4rem 0;font-size:0.9rem;color:var(--text-secondary)}
        .campaign-item-name{color:var(--text-primary)}
        .campaign-item-type{font-size:0.75rem;color:var(--text-faded)}
        /* Loading Skeletons */
        .skeleton{background:linear-gradient(90deg,var(--bg-card) 25%,var(--bg-parchment) 50%,var(--bg-card) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:6px}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        .skeleton-name{height:28px;width:70%;margin-bottom:0.5rem}
        .skeleton-text{height:16px;width:100%;margin-bottom:0.4rem}
        .skeleton-text.short{width:40%}
        .skeleton-card{padding:1rem;background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px;margin-bottom:0.75rem}
        .skeleton-avatar{width:80px;height:80px;border-radius:50%;margin:0 auto 1rem}
        /* Animated Background Particles */
        .particles-container{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:0;overflow:hidden}
        .particle{position:absolute;width:4px;height:4px;background:var(--accent-gold);border-radius:50%;opacity:0;animation:particle-float 15s infinite}
        .particle:nth-child(1){left:10%;animation-delay:0s;animation-duration:20s}
        .particle:nth-child(2){left:20%;animation-delay:2s;animation-duration:18s}
        .particle:nth-child(3){left:30%;animation-delay:4s;animation-duration:22s}
        .particle:nth-child(4){left:40%;animation-delay:1s;animation-duration:19s}
        .particle:nth-child(5){left:50%;animation-delay:3s;animation-duration:21s}
        .particle:nth-child(6){left:60%;animation-delay:5s;animation-duration:17s}
        .particle:nth-child(7){left:70%;animation-delay:2.5s;animation-duration:23s}
        .particle:nth-child(8){left:80%;animation-delay:4.5s;animation-duration:16s}
        .particle:nth-child(9){left:90%;animation-delay:1.5s;animation-duration:24s}
        .particle:nth-child(10){left:95%;animation-delay:3.5s;animation-duration:20s}
        .particle.rune{width:12px;height:12px;background:transparent;border:1px solid var(--accent-gold);opacity:0;font-size:10px;display:flex;align-items:center;justify-content:center;color:var(--accent-gold)}
        @keyframes particle-float{0%{transform:translateY(100vh) rotate(0deg);opacity:0}10%{opacity:0.3}90%{opacity:0.3}100%{transform:translateY(-100vh) rotate(360deg);opacity:0}}
        /* Character Portrait */
        .character-portrait{width:140px;height:140px;margin:0 auto 1.25rem;position:relative;flex-shrink:0}
        .portrait-frame{width:100%;height:100%;border-radius:50%;border:3px solid var(--accent-gold);overflow:hidden;background:var(--bg-parchment);display:flex;align-items:center;justify-content:center;box-shadow:0 0 30px var(--shadow-gold),inset 0 0 20px rgba(0,0,0,0.5)}
        .portrait-frame svg,.portrait-svg{width:100%;height:100%;display:block}
        /* PDF Export */
        .pdf-preview{background:white;color:#333;padding:2rem;border-radius:8px;margin-bottom:1rem}
        /* FAQ */
        .faq-section{margin-top:2.5rem;padding-top:1.5rem;border-top:1px solid var(--border-subtle)}
        .faq-title{font-family:'Cinzel',serif;font-size:1.3rem;color:var(--accent-gold);text-align:center;margin-bottom:1rem}
        .faq-item{background:var(--bg-card);border:1px solid var(--border-subtle);border-radius:8px;margin-bottom:0.5rem;overflow:hidden}
        .faq-question{padding:0.85rem 1rem;font-family:'Cinzel',serif;font-size:0.9rem;font-weight:400;color:var(--text-primary);cursor:pointer;display:flex;justify-content:space-between;align-items:center;margin:0}
        .faq-question:hover{background:rgba(212,168,87,0.05)}
        .faq-question::after{content:'+';font-size:1.2rem;color:var(--accent-gold);transition:transform 0.2s}
        .faq-item.open .faq-question::after{transform:rotate(45deg)}
        .faq-answer{max-height:0;overflow:hidden;transition:max-height 0.3s}
        .faq-item.open .faq-answer{max-height:200px;padding:0 1rem 0.85rem}
        .faq-answer p{color:var(--text-secondary);font-size:0.9rem;line-height:1.6}
        /* Tip Jar */
        .tip-jar{text-align:center;padding:2rem 1rem;margin-top:2rem;background:linear-gradient(135deg,var(--bg-card),var(--bg-parchment));border-radius:12px;border:1px solid var(--border-subtle)}
        .tip-jar-btn{display:inline-flex;align-items:center;gap:0.6rem;padding:0.85rem 1.5rem;background:linear-gradient(135deg,#ff5e5b,#ff9472);border:none;border-radius:8px;color:white;font-family:'Cinzel',serif;font-size:1rem;font-weight:600;text-decoration:none;cursor:pointer;transition:all 0.3s;box-shadow:0 4px 15px rgba(255,94,91,0.3)}
        .tip-jar-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(255,94,91,0.4)}
        .tip-jar-btn svg{width:22px;height:22px}
        .tip-jar-text{display:block;margin-top:0.75rem;color:var(--text-secondary);font-size:0.9rem}
        footer{text-align:center;padding:2rem 0 1rem;color:var(--text-faded);font-size:0.85rem}
        footer a{color:var(--text-secondary);text-decoration:none}
        footer a:hover{color:var(--accent-gold)}
        /* Mobile Styles */
        @media(max-width:600px){
            .container{padding:1rem 0.75rem 2rem}
            .control-row,.control-row.three-col,.control-row.four-col{grid-template-columns:1fr}
            .controls-panel{padding:0.9rem}
            .name-text{font-size:1.05rem}
            .logo-icon{width:36px;height:36px}
            .logo{font-size:1.5rem}
            .btn-row{flex-direction:column}
            .character-stats,.modal-stats{grid-template-columns:1fr}
            .tab-btn{font-size:0.65rem;padding:0.5rem 0.6rem}
            .tab-nav{gap:0.25rem;padding:0 0.25rem}
            .modal{max-width:98%;margin:0.5rem;max-height:90vh}
            .modal-header{padding:0.9rem 1rem}
            .modal-body{padding:1rem}
            .modal-actions{padding:0.9rem 1rem;gap:0.5rem}
            .modal-actions button{flex:1;min-width:0;font-size:0.7rem;padding:0.7rem 0.5rem}
            .party-grid{grid-template-columns:1fr}
            .world-grid{grid-template-columns:1fr}
            .theme-toggle{top:0.5rem;right:0.5rem;width:36px;height:36px}
            .theme-toggle svg{width:16px;height:16px}
            .name-row{flex-wrap:wrap}
            .name-main{width:100%;margin-bottom:0.5rem}
            .name-actions{width:100%;justify-content:flex-start}
            .copy-btn,.action-btn{width:40px;height:40px}
            .secondary-btn{padding:0.75rem;font-size:0.75rem}
            .generate-btn{padding:1rem;font-size:0.9rem}
            .site-nav{gap:1rem}
            .site-nav a{font-size:0.8rem}
            .faq-question{padding:1rem;font-size:0.85rem}
            .character-card{padding:1rem}
            .character-actions{flex-direction:column}
            .character-actions button{width:100%}
            .compare-bar{padding:0.75rem}
            .compare-items{gap:0.4rem}
            .compare-chip{font-size:0.75rem;padding:0.3rem 0.6rem}
            .rarity-badge{font-size:0.6rem}
            .intro-section p{font-size:0.95rem;padding:0 0.5rem}
            .name-preview-text{font-size:0.9rem}
            .party-member{padding:0.85rem}
            .party-member-name{font-size:1rem}
            .tip-jar{padding:1.5rem 1rem;margin-top:1.5rem}
            .tip-jar-btn{padding:0.75rem 1.25rem;font-size:0.9rem}
        }
        @media(max-width:360px){
            .tab-btn{font-size:0.6rem;padding:0.4rem 0.5rem}
            .logo{font-size:1.3rem}
            .tagline{font-size:0.95rem}
        }
        /* Touch-friendly improvements */
        @media(hover:none){
            .copy-btn,.action-btn{width:44px;height:44px}
            .tab-btn{min-height:44px}
            .generate-btn{min-height:48px}
            .secondary-btn{min-height:44px}
            .name-item{padding:1rem}
            .faq-question{min-height:48px}
        }
        @media print{.site-nav,.tab-nav,.controls-panel,.btn-row,.name-actions,.modal-actions,.share-buttons,.history-panel,.faq-section,footer,.ambient-glow,.theme-toggle,.compare-bar{display:none!important}.container{max-width:100%;padding:0}.character-card,.modal{border:2px solid #333;box-shadow:none}.name-item{break-inside:avoid}}
    </style>
</head>
<body>
    <div class="particles-container">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle rune">‚ú¶</div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle rune">‚öî</div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle rune">‚òΩ</div>
        <div class="particle"></div>
    </div>
    <div class="ambient-glow glow-1"></div>
    <div class="ambient-glow glow-2"></div>
    <div class="ambient-glow glow-3"></div>
    <div class="ambient-glow glow-4"></div>
    <div class="ambient-glow glow-5"></div>
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
    <div class="container">
        <button class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode">
            <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
            <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
        </button>
        <header>
            <div class="logo-wrapper">
                <img src="logo.png" alt="MythicNames" class="logo-icon">
                <h1 class="logo">MythicNames</h1>
            </div>
            <p class="tagline">Forge legendary names for your world</p>
            <nav class="site-nav">
                <a href="./" class="active">Generator</a>
                <a href="generators/">Race Names</a>
                <a href="blog/">Blog</a>
            </nav>
        </header>
        
        <section class="intro-section">
            <p>Create unique <strong>fantasy names</strong> for your <strong>D&D characters</strong>, adventuring parties, and entire worlds. Each name includes <strong>pronunciation audio</strong>, meanings, and <strong>character backstories</strong>.</p>
        </section>
        
        <nav class="tab-nav">
            <button type="button" class="tab-btn active" data-tab="generator">‚öîÔ∏è Names</button>
            <button type="button" class="tab-btn" data-tab="party">üë• Party</button>
            <button type="button" class="tab-btn" data-tab="world">üè∞ World</button>
            <button type="button" class="tab-btn" data-tab="races">üßù Races</button>
            <button type="button" class="tab-btn" data-tab="packs">üì¶ Packs</button>
            <button type="button" class="tab-btn" data-tab="character">üé≠ Character</button>
            <button type="button" class="tab-btn" data-tab="campaign">üìö Campaigns</button>
            <button type="button" class="tab-btn" data-tab="history">üìú History<span class="badge" id="historyBadge" style="display:none">0</span></button>
        </nav>
        
        <!-- Generator Tab -->
        <div class="tab-content active" id="tab-generator">
            <div class="controls-panel">
                <div class="control-row">
                    <div class="control-group">
                        <label>Category <i class="tooltip-icon" data-tip="What type of name to generate">?</i></label>
                        <select id="category">
                            <option value="characters">Characters</option>
                            <option value="places">Places</option>
                            <option value="creatures">Creatures</option>
                            <option value="kingdoms">Kingdoms</option>
                            <option value="ships">Ships</option>
                            <option value="taverns">Taverns & Inns</option>
                            <option value="weapons">Weapons</option>
                            <option value="spells">Spells</option>
                            <option value="guilds">Guilds</option>
                            <option value="artifacts">Artifacts</option>
                            <option value="dungeons">Dungeons</option>
                            <option value="titles">Titles & Epithets</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Style <i class="tooltip-icon" data-tip="Cultural/aesthetic style for names">?</i></label>
                        <select id="style">
                            <option value="fantasy">Fantasy</option>
                            <option value="dnd">D&D / High Fantasy</option>
                            <option value="anime">Anime / Japanese</option>
                            <option value="scifi">Sci-Fi</option>
                            <option value="medieval">Medieval</option>
                            <option value="mythological">Mythological</option>
                            <option value="dark">Dark / Gothic</option>
                            <option value="lovecraftian">Lovecraftian</option>
                            <option value="steampunk">Steampunk</option>
                            <option value="pirate">Pirate</option>
                            <option value="norse">Norse / Viking</option>
                            <option value="celtic">Celtic</option>
                            <option value="arabic">Arabic / Persian</option>
                            <option value="slavic">Slavic</option>
                            <option value="egyptian">Egyptian</option>
                            <option value="greek">Greek</option>
                            <option value="roman">Roman</option>
                            <option value="chinese">Chinese / Wuxia</option>
                            <option value="aztec">Aztec / Mayan</option>
                            <option value="african">African</option>
                        </select>
                    </div>
                </div>
                <div class="control-row four-col" id="charOptions">
                    <div class="control-group">
                        <label>Gender <i class="tooltip-icon" data-tip="Masculine, feminine, or neutral sounding">?</i></label>
                        <select id="gender">
                            <option value="any">Any</option>
                            <option value="masculine">Masculine</option>
                            <option value="feminine">Feminine</option>
                            <option value="neutral">Neutral</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Class <i class="tooltip-icon" data-tip="Character class for themed names">?</i></label>
                        <select id="classType">
                            <option value="any">Any Class</option>
                            <option value="warrior">Warrior</option>
                            <option value="mage">Mage</option>
                            <option value="rogue">Rogue</option>
                            <option value="cleric">Cleric</option>
                            <option value="ranger">Ranger</option>
                            <option value="paladin">Paladin</option>
                            <option value="warlock">Warlock</option>
                            <option value="bard">Bard</option>
                            <option value="barbarian">Barbarian</option>
                            <option value="monk">Monk</option>
                            <option value="druid">Druid</option>
                            <option value="necromancer">Necromancer</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Length <i class="tooltip-icon" data-tip="Short (1-6), Medium (5-10), Long (9+)">?</i></label>
                        <select id="length">
                            <option value="any">Any</option>
                            <option value="short">Short</option>
                            <option value="medium">Medium</option>
                            <option value="long">Long</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Results</label>
                        <select id="count">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </div>
                <div class="control-row">
                    <div class="control-group full-width">
                        <label>Keywords <i class="tooltip-icon" data-tip="Optional words to influence name generation">?</i></label>
                        <input type="text" id="keywords" placeholder='e.g. "Shadow", "Fire", "Ancient"'>
                    </div>
                </div>
                <div class="btn-row">
                    <button class="generate-btn" id="generateBtn">Generate Names</button>
                    <button class="secondary-btn" id="copyAllBtn" style="display:none;"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy All</button>
                </div>
            </div>
            <div class="results-section">
                <div class="results-header" id="resultsHeader" style="display:none;">
                    <span class="results-title">Generated Names (<span id="resultsCount">0</span>)</span>
                    <div class="results-actions">
                        <button class="compare-toggle" id="compareToggle" onclick="toggleCompareMode()">‚öñÔ∏è Compare</button>
                        <button class="secondary-btn" onclick="printResults()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9V2h12v7M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>Print</button>
                        <button class="secondary-btn" onclick="exportPDF()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><path d="M14 2v6h6M12 18v-6M9 15l3 3 3-3"/></svg>PDF</button>
                    </div>
                </div>
                <div class="compare-bar" id="compareBar">
                    <div class="compare-bar-header">
                        <span class="compare-bar-title">‚öñÔ∏è Comparing <span id="compareCount">0</span> names</span>
                        <div class="compare-bar-actions">
                            <button class="secondary-btn" onclick="copyCompared()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:12px;height:12px"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy</button>
                            <button class="secondary-btn" onclick="clearCompare()">Clear</button>
                        </div>
                    </div>
                    <div class="compare-items" id="compareItems"></div>
                </div>
                <div id="resultsContainer">
                    <div class="empty-state"><div class="empty-icon">üìú</div><p>Choose your preferences and generate names</p></div>
                </div>
            </div>
        </div>
        
        <!-- Party Generator Tab -->
        <div class="tab-content" id="tab-party">
            <div class="info-box">Generate a complete adventuring party with relationships, bonds, and conflicts.</div>
            <div class="controls-panel">
                <div class="control-row three-col">
                    <div class="control-group">
                        <label>Party Size</label>
                        <select id="partySize">
                            <option value="3">Small (3)</option>
                            <option value="4" selected>Standard (4)</option>
                            <option value="5">Large (5)</option>
                            <option value="6">Full (6)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Composition</label>
                        <select id="partyComp">
                            <option value="balanced">Balanced</option>
                            <option value="combat">Combat Heavy</option>
                            <option value="stealth">Stealth Focus</option>
                            <option value="magic">Magic Focus</option>
                            <option value="random">Random</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Style</label>
                        <select id="partyStyle">
                            <option value="fantasy">Fantasy</option>
                            <option value="dnd">D&D</option>
                            <option value="dark">Dark</option>
                            <option value="anime">Anime</option>
                        </select>
                    </div>
                </div>
                <div class="btn-row">
                    <button class="generate-btn" id="generatePartyBtn">Generate Party</button>
                </div>
            </div>
            <div id="partyContainer"></div>
        </div>
        
        <!-- World Builder Tab -->
        <div class="tab-content" id="tab-world">
            <div class="info-box">Generate an entire kingdom with cities, factions, NPCs, and conflicts.</div>
            <div class="controls-panel">
                <div class="control-row three-col">
                    <div class="control-group">
                        <label>Kingdom Type</label>
                        <select id="worldType">
                            <option value="medieval">Medieval Kingdom</option>
                            <option value="empire">Empire</option>
                            <option value="republic">Republic</option>
                            <option value="tribal">Tribal Lands</option>
                            <option value="magocracy">Magocracy</option>
                            <option value="theocracy">Theocracy</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Size</label>
                        <select id="worldSize">
                            <option value="small">Small (3 cities)</option>
                            <option value="medium" selected>Medium (5 cities)</option>
                            <option value="large">Large (8 cities)</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Conflict Level</label>
                        <select id="worldConflict">
                            <option value="peaceful">Peaceful</option>
                            <option value="tense" selected>Tense</option>
                            <option value="war">At War</option>
                        </select>
                    </div>
                </div>
                <div class="btn-row">
                    <button class="generate-btn" id="generateWorldBtn">Generate Kingdom</button>
                </div>
            </div>
            <div id="worldContainer"></div>
        </div>
        
        <!-- Race Names Tab -->
        <div class="tab-content" id="tab-races">
            <div class="info-box">Select a race to generate names specifically tailored to that fantasy race.</div>
            <div class="race-grid" id="raceGrid">
                <div class="race-card" data-race="elf"><div class="race-icon">üßù</div><div class="race-name">Elf</div></div>
                <div class="race-card" data-race="dwarf"><div class="race-icon">‚õèÔ∏è</div><div class="race-name">Dwarf</div></div>
                <div class="race-card" data-race="orc"><div class="race-icon">üëπ</div><div class="race-name">Orc</div></div>
                <div class="race-card" data-race="human"><div class="race-icon">üë§</div><div class="race-name">Human</div></div>
                <div class="race-card" data-race="halfling"><div class="race-icon">ü¶∂</div><div class="race-name">Halfling</div></div>
                <div class="race-card" data-race="gnome"><div class="race-icon">üé©</div><div class="race-name">Gnome</div></div>
                <div class="race-card" data-race="tiefling"><div class="race-icon">üòà</div><div class="race-name">Tiefling</div></div>
                <div class="race-card" data-race="dragonborn"><div class="race-icon">üêâ</div><div class="race-name">Dragonborn</div></div>
                <div class="race-card" data-race="vampire"><div class="race-icon">üßõ</div><div class="race-name">Vampire</div></div>
                <div class="race-card" data-race="angel"><div class="race-icon">üëº</div><div class="race-name">Angel</div></div>
                <div class="race-card" data-race="demon"><div class="race-icon">üëø</div><div class="race-name">Demon</div></div>
                <div class="race-card" data-race="fairy"><div class="race-icon">üßö</div><div class="race-name">Fairy</div></div>
            </div>
            <div class="controls-panel" style="margin-top:1rem;">
                <div class="control-row three-col">
                    <div class="control-group"><label>Gender</label><select id="raceGender"><option value="any">Any</option><option value="masculine">Masculine</option><option value="feminine">Feminine</option></select></div>
                    <div class="control-group"><label>Count</label><select id="raceCount"><option value="5">5</option><option value="10" selected>10</option><option value="20">20</option></select></div>
                    <div class="control-group"><label>&nbsp;</label><button class="generate-btn" id="generateRaceBtn" style="width:100%">Generate</button></div>
                </div>
            </div>
            <div id="raceResults"></div>
        </div>
        
        <!-- Name Packs Tab -->
        <div class="tab-content" id="tab-packs">
            <div class="info-box">Curated name collections for specific character types and scenarios.</div>
            <div class="pack-grid" id="packGrid">
                <div class="pack-card" data-pack="villains"><div class="pack-icon">üíÄ</div><div class="pack-name">Villains</div><div class="pack-desc">Dark lords & evil sorcerers</div></div>
                <div class="pack-card" data-pack="heroes"><div class="pack-icon">‚öîÔ∏è</div><div class="pack-name">Heroes</div><div class="pack-desc">Brave warriors & champions</div></div>
                <div class="pack-card" data-pack="royalty"><div class="pack-icon">üëë</div><div class="pack-name">Royalty</div><div class="pack-desc">Kings, queens & nobles</div></div>
                <div class="pack-card" data-pack="wizards"><div class="pack-icon">üßô</div><div class="pack-name">Wizards</div><div class="pack-desc">Archmages & mystics</div></div>
                <div class="pack-card" data-pack="rogues"><div class="pack-icon">üó°Ô∏è</div><div class="pack-name">Rogues</div><div class="pack-desc">Thieves & assassins</div></div>
                <div class="pack-card" data-pack="merchants"><div class="pack-icon">üí∞</div><div class="pack-name">NPCs</div><div class="pack-desc">Merchants & commoners</div></div>
                <div class="pack-card" data-pack="party"><div class="pack-icon">üé≠</div><div class="pack-name">Party</div><div class="pack-desc">Adventuring group</div></div>
                <div class="pack-card" data-pack="monsters"><div class="pack-icon">üê≤</div><div class="pack-name">Monsters</div><div class="pack-desc">Legendary beasts</div></div>
            </div>
            <div id="packResults"></div>
        </div>
        
        <!-- Character Creator Tab -->
        <div class="tab-content" id="tab-character">
            <div class="info-box">Create a complete character with name, backstory, relationships, and more.</div>
            <div class="controls-panel">
                <div class="control-row three-col">
                    <div class="control-group"><label>Race</label><select id="charRace"><option value="random">Random</option><option value="human">Human</option><option value="elf">Elf</option><option value="dwarf">Dwarf</option><option value="halfling">Halfling</option><option value="gnome">Gnome</option><option value="tiefling">Tiefling</option><option value="dragonborn">Dragonborn</option></select></div>
                    <div class="control-group"><label>Class</label><select id="charClass"><option value="random">Random</option><option value="warrior">Warrior</option><option value="mage">Mage</option><option value="rogue">Rogue</option><option value="cleric">Cleric</option><option value="ranger">Ranger</option><option value="paladin">Paladin</option><option value="bard">Bard</option></select></div>
                    <div class="control-group"><label>Gender</label><select id="charGender"><option value="random">Random</option><option value="masculine">Masculine</option><option value="feminine">Feminine</option></select></div>
                </div>
                <div class="btn-row">
                    <button class="generate-btn" id="generateCharBtn">Create Character</button>
                </div>
            </div>
            <div id="characterContainer"></div>
        </div>
        
        <!-- History Tab -->
        <div class="tab-content" id="tab-history">
            <div class="history-header">
                <div class="info-box" style="margin:0;flex:1">Your recently generated names are saved here. Click to copy.</div>
                <button class="secondary-btn danger-btn" onclick="confirmClearHistory()">üóëÔ∏è Clear All</button>
            </div>
            <div id="historyList" class="names-list"></div>
        </div>
        
        <!-- Campaign Manager Tab -->
        <div class="tab-content" id="tab-campaign">
            <div class="info-box">Save parties, characters, and worlds to campaigns. Data is stored locally in your browser.</div>
            <div class="controls-panel">
                <div class="control-row">
                    <div class="control-group">
                        <label>Campaign Name</label>
                        <input type="text" id="newCampaignName" placeholder="e.g., Dragon's Lair Campaign">
                    </div>
                    <div class="control-group" style="justify-content:flex-end;">
                        <label>&nbsp;</label>
                        <button type="button" class="generate-btn" onclick="createCampaign()" style="width:100%">Create Campaign</button>
                    </div>
                </div>
            </div>
            <div id="campaignList"></div>
        </div>
        
        <!-- Share Card Modal -->
        <div class="modal-overlay" id="shareCardModal">
            <div class="modal" style="max-width:500px;">
                <div class="modal-header">
                    <h3 class="modal-title">Share Character Card</h3>
                    <button class="modal-close" onclick="closeShareModal()">&times;</button>
                </div>
                <div class="modal-body" style="text-align:center;">
                    <canvas id="shareCanvas" width="500" height="300" style="max-width:100%;border-radius:8px;"></canvas>
                    <p style="margin-top:1rem;font-size:0.9rem;color:var(--text-secondary);">Right-click to save or use buttons below</p>
                </div>
                <div class="modal-actions">
                    <button class="secondary-btn" onclick="downloadShareCard()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"/></svg>Download</button>
                    <button class="secondary-btn twitter" onclick="shareCardTwitter()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>Tweet</button>
                </div>
            </div>
        </div>
        
        <div class="toast" id="toast">Copied to clipboard</div>
        
        <!-- Backstory Modal -->
        <div class="modal-overlay" id="backstoryModal">
            <div class="modal">
                <div class="modal-header">
                    <h3 class="modal-title" id="modalTitle">Character Backstory</h3>
                    <button class="modal-close" onclick="closeModal()">&times;</button>
                </div>
                <div class="modal-body" id="modalBody"></div>
                <div class="modal-actions">
                    <button class="secondary-btn" onclick="createCardFromModal()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M3 9h18M9 21V9"/></svg>Share Card</button>
                    <button class="secondary-btn" onclick="copyBackstory()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy</button>
                    <button class="secondary-btn" onclick="shareTwitter()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>Tweet</button>
                    <button class="generate-btn" onclick="regenerateBackstory()" style="flex:1">Regenerate</button>
                </div>
            </div>
        </div>

        <!-- Tip Jar -->
        <div class="tip-jar">
            <a href="https://ko-fi.com/meeeertyn" target="_blank" rel="noopener" class="tip-jar-btn">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604 0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734 4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09-.443-.441-3.368-3.049-4.034-3.954-.709-.965-1.041-2.7-.091-3.71.951-1.01 3.005-1.086 4.363.407 0 0 1.565-1.782 3.468-.963 1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z"/></svg>
                Support the Forge
            </a>
            <span class="tip-jar-text">Help keep MythicNames free!</span>
        </div>

        <!-- FAQ Section -->
        <section class="faq-section">
            <h2 class="faq-title">Frequently Asked Questions</h2>
            <article class="faq-item"><h3 class="faq-question" onclick="this.parentElement.classList.toggle('open')">How does the fantasy name generator work?</h3><div class="faq-answer"><p>MythicNames uses linguistic algorithms combining syllable patterns and style-specific conventions to generate unique names. Each name includes pronunciation, meaning, and optional backstories with factions and relationships.</p></div></article>
            <article class="faq-item"><h3 class="faq-question" onclick="this.parentElement.classList.toggle('open')">Can I use these names commercially?</h3><div class="faq-answer"><p>Yes! All generated names are free to use for any purpose including D&D campaigns, novels, video games, and commercial projects. Names are procedurally generated and not copyrighted.</p></div></article>
            <article class="faq-item"><h3 class="faq-question" onclick="this.parentElement.classList.toggle('open')">What is the Party Generator?</h3><div class="faq-answer"><p>The Party Generator creates a balanced adventuring group with names, classes, and inter-party relationships including bonds, rivalries, and romantic interests.</p></div></article>
            <article class="faq-item"><h3 class="faq-question" onclick="this.parentElement.classList.toggle('open')">What does the World Builder create?</h3><div class="faq-answer"><p>The World Builder generates an entire kingdom with a ruler, cities, factions, key NPCs, and active conflicts‚Äîperfect for DMs creating campaign settings.</p></div></article>
            <article class="faq-item"><h3 class="faq-question" onclick="this.parentElement.classList.toggle('open')">How do I hear name pronunciations?</h3><div class="faq-answer"><p>Click the speaker icon next to any pronunciation guide to hear it spoken aloud using text-to-speech technology.</p></div></article>
        </section>

        <footer>
            <p>¬© 2025 <strong>MythicNames</strong> ‚Äî Free Fantasy Name Generator for D&D, Pathfinder & Writers</p>
            <p style="margin-top:0.5rem;"><a href="generators/elf-name-generator.html">Elf Names</a> ‚Ä¢ <a href="generators/dwarf-name-generator.html">Dwarf Names</a> ‚Ä¢ <a href="generators/orc-name-generator.html">Orc Names</a> ‚Ä¢ <a href="generators/tiefling-name-generator.html">Tiefling Names</a> ‚Ä¢ <a href="generators/">All Races</a> ‚Ä¢ <a href="blog/">Blog</a></p>
        </footer>
    </div>

    <script>
    // ============ THEME TOGGLE ============
    function toggleTheme() {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'light' ? 'dark' : 'light';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
    }
    
    // Initialize theme from localStorage
    (function() {
        const saved = localStorage.getItem('theme');
        if (saved) {
            document.documentElement.setAttribute('data-theme', saved);
        } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
            document.documentElement.setAttribute('data-theme', 'light');
        }
    })();
    
    // ============ COMPARISON MODE ============
    let compareMode = false;
    let compareList = [];
    
    function toggleCompareMode() {
        compareMode = !compareMode;
        document.getElementById('compareToggle').classList.toggle('active', compareMode);
        document.querySelectorAll('.name-item').forEach(item => {
            item.classList.toggle('compare-mode', compareMode);
        });
        if (!compareMode) {
            clearCompare();
        }
        updateCompareBar();
    }
    
    function toggleCompareItem(name, index) {
        if (!compareMode) return;
        
        const idx = compareList.findIndex(c => c.name === name);
        if (idx >= 0) {
            compareList.splice(idx, 1);
        } else if (compareList.length < 10) {
            compareList.push({ name, index });
        } else {
            showToast('Maximum 10 names to compare');
            return;
        }
        
        updateCompareBar();
        updateCompareSelection();
    }
    
    function updateCompareBar() {
        const bar = document.getElementById('compareBar');
        const count = document.getElementById('compareCount');
        const items = document.getElementById('compareItems');
        
        if (compareList.length > 0) {
            bar.classList.add('show');
            count.textContent = compareList.length;
            items.innerHTML = compareList.map(c => 
                `<div class="compare-chip"><span>${esc(c.name)}</span><button onclick="removeFromCompare('${esc(c.name).replace(/'/g, "\\'")}')">&times;</button></div>`
            ).join('');
        } else {
            bar.classList.remove('show');
        }
    }
    
    function updateCompareSelection() {
        document.querySelectorAll('.name-item').forEach((item, i) => {
            const isSelected = compareList.some(c => c.index === i);
            item.classList.toggle('compare-selected', isSelected);
        });
    }
    
    function removeFromCompare(name) {
        compareList = compareList.filter(c => c.name !== name);
        updateCompareBar();
        updateCompareSelection();
    }
    
    function clearCompare() {
        compareList = [];
        updateCompareBar();
        updateCompareSelection();
    }
    
    async function copyCompared() {
        const text = compareList.map(c => c.name).join('\n');
        try {
            await navigator.clipboard.writeText(text);
            showToast('Copied ' + compareList.length + ' names!');
        } catch(e) {}
    }
    
    // ============ RARITY SCORE ============
    const raritySeenNames = new Set();
    
    function calculateRarity(name) {
        // Factors that increase rarity:
        // 1. Name length (very short or very long = rarer)
        // 2. Unusual letter combinations
        // 3. Unique syllable patterns
        // 4. Less common starting letters
        
        const n = name.toLowerCase().replace(/[^a-z]/g, '');
        let score = 50; // Base score
        
        // Length bonus
        if (n.length <= 4) score += 15;
        else if (n.length >= 12) score += 20;
        else if (n.length >= 9) score += 10;
        
        // Uncommon letters bonus
        const uncommon = (n.match(/[qxzjv]/g) || []).length;
        score += uncommon * 8;
        
        // Double letters
        const doubles = (n.match(/(.)\1/g) || []).length;
        score += doubles * 5;
        
        // Uncommon starting letters
        if (/^[qxzvy]/.test(n)) score += 12;
        else if (/^[jkw]/.test(n)) score += 6;
        
        // Apostrophe or hyphen in original
        if (/[''-]/.test(name)) score += 10;
        
        // Unusual endings
        if (/(?:yx|ax|ix|ox|th|wyn|iel)$/i.test(n)) score += 8;
        
        // Random variation
        score += Math.floor(Math.random() * 10);
        
        // Clamp to 0-100
        return Math.min(100, Math.max(0, score));
    }
    
    function getRarityTier(score) {
        if (score >= 85) return { tier: 'legendary', label: '‚ú® Legendary', cls: 'rarity-legendary' };
        if (score >= 70) return { tier: 'epic', label: 'üíú Epic', cls: 'rarity-epic' };
        if (score >= 50) return { tier: 'rare', label: 'üíô Rare', cls: 'rarity-rare' };
        if (score >= 30) return { tier: 'uncommon', label: 'üíö Uncommon', cls: 'rarity-uncommon' };
        return { tier: 'common', label: 'Common', cls: 'rarity-common' };
    }
    
    // ============ DATA ============
    const D = {
        styles:{
            fantasy:{pre:['Ael','Bran','Cal','Dor','Eld','Fae','Gal','Har','Ith','Jar','Kel','Lor','Mor','Nir','Oth','Pyr','Quin','Ral','Syl','Thr','Ul','Val','Wyr','Xan','Yar','Zeph'],mid:['an','ar','el','en','ia','il','ir','on','or','ra','ri','th','wen'],suf:{m:['an','or','in','us','ar','ion','ius','orn','ald','ric'],f:['a','ia','wen','elle','ine','ara','ira','yn','eth','is'],n:['el','yn','is','en','al','ix','ax']}},
            dnd:{pre:['Arth','Bael','Cad','Drak','Elm','Fen','Grim','Helm','Ir','Jax','Kael','Luth','Mord','Nyx','Obr','Phen','Quel','Rav','Sor','Thal','Ur','Vex','Wulf','Xyr','Yss','Zar'],mid:['ae','al','an','ar','el','en','il','or','ri','th','ur'],suf:{m:['or','us','an','ar','ius','on','ax','ek','rim','thar'],f:['a','ia','is','yn','ara','iel','wen','eth','ira','elle'],n:['ix','ax','el','yn','is','ex']}},
            anime:{pre:['Aki','Haru','Hiro','Kai','Kira','Masa','Nao','Rei','Rin','Ryu','Sak','Sen','Shin','Sora','Taka','Yuki','Yuri','Zen','Miko','Hana','Asa','Kazu','Nobu','Shiro'],mid:['ko','mi','na','no','ra','ri','ro','sa','shi','ta','to','ya'],suf:{m:['o','ta','ki','shi','ro','ya','ma','suke','hiko','ji'],f:['ko','mi','na','ka','ri','yo','ne','e','ra','ya'],n:['a','i','u','ki','ru']}},
            scifi:{pre:['Ax','Bex','Cyr','Dex','Exa','Flux','Gex','Hex','Ion','Jax','Kex','Lux','Max','Nex','Orb','Pax','Qex','Rex','Syn','Tex','Ux','Vex','Wex','Xen','Yex','Zex'],mid:['or','ar','ix','on','ax','ex'],suf:{m:['on','ax','ex','or','us','ius','ar','ix'],f:['a','ia','ix','ya','ona','ara'],n:['x','ex','ix','ox','ax']}},
            medieval:{pre:['Ald','Bald','Ced','Dag','Ed','Frid','God','Had','Ith','Jor','Ken','Leof','Mald','Nor','Os','Pend','Rad','Sig','Thor','Ulf','Wald','Wulf','Wyn','Ath','Bert'],mid:['el','er','red','ric','win','ard','mund','stan','gar'],suf:{m:['ric','ard','mund','red','win','ulf','stan','bert','gar','ald'],f:['a','ild','ith','run','wyn','gard','lind','trud','hild'],n:['e','in','ey']}},
            mythological:{pre:['Ach','Apo','Art','Ath','Dem','Dio','Hec','Her','Hyp','Jas','Med','Nem','Ody','Orp','Per','Pho','Pro','Pyr','The','Tri','Tyr','Ura','Zel','Adr','Pan'],mid:['ae','eu','io','oe','ei','ai','au'],suf:{m:['us','on','es','os','eus','ius','an'],f:['a','e','ia','eia','one','ope','ene'],n:['is','ys','os']}},
            dark:{pre:['Abr','Bal','Cor','Dra','Eth','Fel','Gra','Hex','Ink','Jek','Kra','Lur','Mal','Nec','Omb','Pla','Rav','Sha','Sty','Ten','Umb','Voi','Wra','Xul','Zep'],mid:['ak','al','ar','ax','ok','ul','ur'],suf:{m:['ak','ax','or','us','ul','yx','ok','ar'],f:['a','ia','yx','ra','ith','ura','yss'],n:['x','yx','ax','ox']}},
            norse:{pre:['Alf','Bjor','Dag','Ein','Frey','Grim','Half','Ing','Jar','Ket','Lei','Mag','Nar','Odd','Rag','Sig','Thor','Ulf','Vig','Yng','Orm','Hal','Sven','Har'],mid:['ar','un','or','in','al','ul'],suf:{m:['ar','ir','or','ur','ulf','ald','rim','vald','bjorn'],f:['a','dis','run','hild','rid','vor','ey','ny'],n:['i','r','n']}},
            celtic:{pre:['Aed','Bran','Cael','Diar','Eog','Fion','Gal','Iar','Kil','Lugh','Mael','Niall','Ois','Pdr','Rian','Sean','Tir','Ultan','Brig','Con','Finn','Corm'],mid:['an','en','in','on','ach','agh'],suf:{m:['an','us','in','ach','agh','aid','og','mac'],f:['a','een','id','ith','nat','wen','nait'],n:['an','in','en']}},
            arabic:{pre:['Abd','Ah','Ali','Ami','Fai','Far','Has','Ibr','Jas','Kar','Lai','Mah','Nas','Om','Qas','Rah','Sal','Tar','Yas','Zah','Nur','Sad','Saf','Zai'],mid:['al','ar','ir','ul','am','im'],suf:{m:['ad','id','im','ir','ud','an','ar'],f:['a','ah','ia','iya','ra','ina','ima'],n:['i','ir','an']}},
            slavic:{pre:['Bog','Bor','Dra','Jar','Kaz','Lech','Mir','Rad','Sla','Stan','Vas','Vlad','Vol','Yar','Zbi','Sve','Prav','Lju','Zdr','Mil'],mid:['o','i','a','e'],suf:{m:['mir','slav','dan','bor','rad','mil','voj','ko'],f:['a','ka','na','ina','ara','mila','slava'],n:['o','a','e']}},
            egyptian:{pre:['Akh','Amen','Ankh','Aten','Hapi','Hor','Isis','Kha','Maat','Neb','Nef','Nut','Osir','Ptah','Ra','Sek','Set','Thot','Tut','Waset'],mid:['en','et','em','an'],suf:{m:['is','hotep','mose','nakht','re','amun'],f:['et','it','nefert','mut','isi'],n:['is','en','et']}},
            greek:{pre:['Alex','Andr','Arist','Dem','Dio','Eur','Hel','Her','Leo','Nik','Olym','Per','Phil','Plat','Soc','Theo','Xen','Zeu','Apo','Ath'],mid:['o','i','a','e'],suf:{m:['os','us','es','on','eus','ander','acles'],f:['a','ia','e','eia','ope','ene','meda'],n:['is','ys','on']}},
            roman:{pre:['Aur','Caes','Clau','Flav','Gai','Jul','Luc','Marc','Oct','Pub','Quin','Serg','Tib','Val','Vit','Cor','Max','Sext','Ter','Dom'],mid:['i','u','e','a'],suf:{m:['us','ius','anus','inus','ius','ax'],f:['a','ia','ina','illa','lia'],n:['um','ius','us']}},
            chinese:{pre:['Bai','Chen','Feng','Guan','Hua','Jian','Kai','Lei','Ming','Ning','Peng','Qing','Rui','Shan','Tian','Wei','Xia','Yan','Zhen','Jun','Long','Mei'],mid:['',''],suf:{m:['long','wei','feng','ming','jun','tao'],f:['hua','mei','lan','xia','yan','ying'],n:['en','an','in']}},
            aztec:{pre:['Acatl','Cit','Coatl','Cuauh','Huitzi','Itz','Mix','Nez','Quetz','Tez','Tla','Xoch','Yao','Zol','Chim','Tonal','Mict'],mid:['al','il','li'],suf:{m:['tl','tzin','coatl','tli','oc'],f:['xoch','atl','cihuatl','tzin'],n:['tl','li','atl']}},
            african:{pre:['Aba','Ade','Chi','Esi','Fum','Ima','Jab','Kam','Kof','Kwame','Mala','Nana','Obi','Sek','Tah','Udo','Yaw','Zub','Ayo','Dak'],mid:['a','i','o','u','e'],suf:{m:['i','o','u','ade','oko','emi'],f:['a','i','oma','eka','ayo'],n:['a','i','e']}},
            lovecraftian:{pre:['Azath','Cthul','Dagon','Hastur','Ithaqu','Nyarl','Shub','Tsath','Yig','Yog','Zhar','Atlach','Byakh','Ghat','Rlye','Sarnath'],mid:['oth','ath','ul','ar','og'],suf:{m:['oth','hu','og','ath','ul','ar'],f:['ath','ia','yth','ara'],n:['oth','ul','og','ath']}},
            steampunk:{pre:['Brass','Clock','Cog','Copper','Gear','Iron','Mech','Piston','Rivet','Steam','Bolt','Valve','Spring','Wren','Ash','Coal','Forge'],mid:['','er','on'],suf:{m:['ton','worth','wick','wood','ford','well','wright'],f:['ine','ette','ora','ina','belle'],n:['x','er','on']}},
            pirate:{pre:['Black','Blood','Bone','Dread','Iron','Mad','One','Red','Salt','Scar','Sea','Silver','Storm','Dark','Grey','Long','Bloody'],mid:['',''],suf:{m:['beard','eye','hand','hook','jack','tooth','bones'],f:['anne','belle','mary','jane','grace'],n:['dog','rat','skull','wind']}}
        },
        races:{
            elf:{pre:['Ael','Cel','Eil','Fae','Gal','Lir','Mir','Sil','Tel','Thil','Ven','Aer','Cael','Ela','Nae'],mid:['an','ar','el','en','ia','ri','wen'],suf:{m:['andir','orn','ion','iel','orin','ril','thas'],f:['wen','iel','ara','ria','eth','lyn','thien'],n:['el','is','yn','ael']},meanings:['star','moon','silver','light','wind','leaf','dream','song']},
            dwarf:{pre:['Bal','Bom','Dor','Dur','Gim','Gror','Kil','Mor','Thor','Thror','Brun','Dal','Gar','Krag'],mid:['in','ur','li','din','bur'],suf:{m:['in','ur','din','grim','mund','rek','rim'],f:['a','dis','hild','lin','ra'],n:['i','in','ur']},meanings:['stone','iron','gold','hammer','anvil','forge','mountain','axe']},
            orc:{pre:['Azog','Bolg','Grak','Grim','Gruk','Krag','Morg','Thok','Ugg','Durg','Gash','Zug'],mid:['ak','ash','gor','mak','og','uk'],suf:{m:['ak','ash','gor','gul','og','uk','grom'],f:['a','ra','sha','ga','za'],n:['ak','ok','ug']},meanings:['blood','war','skull','rage','battle','death','strength']},
            human:{pre:['Al','Bran','Cor','Ed','Gar','Hal','Ian','Lor','Mar','Per','Val','Wil','Rod','Leon'],mid:['an','ar','el','er','in','on'],suf:{m:['an','ar','ic','or','us','ric','ton','ald'],f:['a','ia','ine','lyn','ra','wen','elle'],n:['e','i','y']},meanings:['brave','noble','strong','wise','swift','true','bold']},
            halfling:{pre:['Bil','Fro','Mer','Per','Sam','Pip','Dro','Ham','Wil','Ros','Tan','Cor'],mid:['do','go','bo','lo','ri'],suf:{m:['bo','do','go','lo','bert','wise'],f:['a','ina','ella','ie','y'],n:['i','y','o']},meanings:['home','hearth','luck','feast','merry','garden','comfort']},
            gnome:{pre:['Fiz','Gim','Nim','Zook','Bim','Glim','Pip','Spark','Tink','Wiz','Cog'],mid:['ble','ck','nk','pp'],suf:{m:['ble','ck','wick','wort','sprocket'],f:['a','i','ette','ine','ie'],n:['i','ix','o']},meanings:['clever','bright','tinker','spark','gadget','trick']},
            tiefling:{pre:['Akm','Bar','Dam','Kair','Mor','Nem','Ori','Raz','Val','Zar','Meph'],mid:['ae','ai','ei','az','iz'],suf:{m:['eus','ion','ius','os','us','akos'],f:['a','ia','is','ys','ira','yra'],n:['is','ys','ax','ix']},meanings:['flame','shadow','sin','pride','wrath','cunning','charm']},
            dragonborn:{pre:['Arj','Bal','Bharash','Ghesh','Kri','Med','Nadar','Raz','Sham','Tor','Vor'],mid:['aash','ash','dar','gar','kar'],suf:{m:['aan','asar','inn','ash','thar'],f:['a','ira','ora','ann','ra'],n:['ash','ar','ax']},meanings:['fire','honor','scale','claw','breath','might','pride']},
            vampire:{pre:['Vlad','Alucard','Carm','Drac','Lest','Nos','Strah','Var','Mal','Raz'],mid:['an','en','in','or'],suf:{m:['ius','os','us','an','ir'],f:['a','ia','ina','ella','ira'],n:['is','ys','ax']},meanings:['blood','night','eternal','shadow','thirst','crimson']},
            angel:{pre:['Aur','Cel','Gab','Mich','Raph','Ser','Uri','Zad','Soph','Zeph'],mid:['ae','ia','ael','iel'],suf:{m:['ael','iel','ion','el','on'],f:['ael','iel','ia','ara','iah'],n:['el','iel','ael']},meanings:['light','grace','divine','heaven','radiance','hope']},
            demon:{pre:['Abr','Azr','Bal','Bel','Mal','Xar','Zar','Gor','Meph','Asmo'],mid:['az','ez','iz','ael','oth'],suf:{m:['oth','ael','ion','or','az'],f:['ith','yth','ia','yra','ara'],n:['oth','ax','ix']},meanings:['chaos','torment','fire','abyss','corruption','malice']},
            fairy:{pre:['Bri','Dew','Fern','Glow','Ivy','Luna','Moss','Petal','Rose','Star','Wisp'],mid:['an','el','ia','in','le'],suf:{m:['an','en','in','le','or'],f:['a','ia','belle','ette','wyn'],n:['i','y','ie']},meanings:['sparkle','dew','petal','moonbeam','whisper','shimmer']}
        },
        cls:{
            warrior:{wep:['sword','axe','hammer','greatsword','spear','mace'],tr:['brave','strong','battle-hardened','fearless','valiant']},
            mage:{wep:['staff','wand','tome','orb','crystal','grimoire'],tr:['intelligent','powerful','mysterious','arcane','scholarly']},
            rogue:{wep:['daggers','shortbow','rapier','crossbow','throwing knives'],tr:['cunning','quick','stealthy','shadowy','silent']},
            cleric:{wep:['mace','holy symbol','staff','morning star','shield'],tr:['faithful','compassionate','wise','devoted','righteous']},
            ranger:{wep:['longbow','twin swords','spear','hunting knife','crossbow'],tr:['perceptive','patient','skilled','wild','keen-eyed']},
            paladin:{wep:['longsword','warhammer','shield','holy avenger','lance'],tr:['righteous','devoted','courageous','noble','unwavering']},
            warlock:{wep:['pact blade','eldritch focus','tome','rod','amulet'],tr:['enigmatic','dark','ambitious','bound','secretive']},
            bard:{wep:['rapier','lute','short sword','hand crossbow','flute'],tr:['charismatic','creative','clever','charming','inspiring']},
            barbarian:{wep:['greataxe','greatsword','maul','handaxes','club'],tr:['fierce','wild','unstoppable','primal','raging']},
            monk:{wep:['quarterstaff','fists','nunchaku','darts','kama'],tr:['disciplined','serene','swift','focused','enlightened']},
            druid:{wep:['scimitar','wooden staff','sickle','quarterstaff','totem'],tr:['natural','wise','shapeshifting','ancient','wild']},
            necromancer:{wep:['skull staff','bone wand','grimoire','dagger','phylactery'],tr:['dark','forbidden','calculating','deathly','pale']}
        },
        back:{
            origin:['Born in a small village on the outskirts of the realm','Raised in the bustling streets of a great city','Grew up among wandering nomads who traveled the endless plains','Orphaned young and raised by monks in a secluded monastery','Descended from a long line of legendary warriors','Found abandoned as an infant on the steps of a temple','Born during a celestial event of great significance','Raised by a reclusive mage in a tower filled with mysteries','The sole survivor of a village destroyed by unknown forces','Born into a family of renowned scholars and sages'],
            childhood:['Their earliest memory is of a fire consuming everything they knew','They learned to fight before they learned to read','Books and scrolls were their only companions in a lonely childhood','They were always different from the other children, set apart by fate','A mentor figure shaped their early years with harsh but fair lessons','They spent years on the streets, learning to survive by any means'],
            event:['witnessed a great tragedy that changed everything','discovered a hidden talent that set them apart','was visited by a mysterious stranger bearing a prophecy','survived an attack that claimed many lives','found an ancient artifact that seemed to call to them','was betrayed by someone they trusted completely','made a desperate pact with an unknown entity','was marked by a strange magical phenomenon','discovered the truth about their real parentage'],
            turning:['The day they took up their weapon for the first time, they knew their purpose','A near-death experience showed them what truly mattered','Meeting their future mentor opened doors they never knew existed','Leaving home was the hardest‚Äîand best‚Äîdecision they ever made','The first time they saved an innocent, they found their calling'],
            trait:['Known for their quick wit and sharp tongue','Quiet and observant, they miss nothing','Fiercely loyal to those they call friend','Haunted by memories that refuse to fade','Bold to the point of recklessness','Compassionate, always helping those in need','Hot-tempered but fiercely protective','Curious about everything, sometimes dangerously so','Stoic and unshakeable in the face of danger'],
            motive:['Now they seek to uncover the truth of their origins','Revenge burns in their heart against those who wronged them','They search desperately for a cure to a terrible curse','Glory and gold call to them on the open road','They have sworn to protect others from darkness','A promise made long ago compels them onward','Redemption for past mistakes fuels their journey'],
            goal:['They dream of founding a sanctuary for others like themselves','Wealth and power are their only securities','They hope to find a place where they truly belong','An ancient wrong must be set right, no matter how long it takes'],
            faction:[{name:'The Silver Dawn',desc:'a secretive order fighting darkness',role:['initiate','agent','seeker']},{name:'The Raven Court',desc:'a network of spies and information brokers',role:['informant','shadow','whisper']},{name:'The Iron Covenant',desc:'a brotherhood of warriors bound by oaths',role:['sworn blade','champion','sentinel']},{name:'The Arcane Collective',desc:'mages sharing forbidden knowledge',role:['apprentice','scholar','arcanist']}],
            secret:['They carry a sealed letter addressed to someone they cannot find','A voice whispers to them in dreams, offering guidance‚Äîor temptation','They once killed someone who did not deserve to die','Their body bears a mark matching an ancient prophecy','Someone they believed dead is actually alive‚Äîand hunting them'],
            flaw:['They cannot resist a game of chance','Old wounds ache when danger approaches','They trust too easily, having been burned before','Nightmares plague their sleep','Strong drink has been both comfort and weakness','Arrogance blinds them to their limitations']
        },
        relationships:{
            positive:['childhood friends who reunited by chance','saved each other\'s lives in battle','former rivals who gained mutual respect','share a dark secret only they know','bonded over shared loss','mentor and student','siblings separated at birth'],
            negative:['compete for the same glory','old grudge from a past betrayal','romantic rivals','owe a debt that festers','philosophical enemies','one cost the other everything'],
            romantic:['secret admirers','former lovers reunited','obvious tension everyone notices','betrothed by families','star-crossed by faction loyalty']
        },
        world:{
            cityTypes:['Capital','Port','Mountain Hold','Forest Haven','Desert Oasis','Border Fortress','Trade Hub','Ancient Ruins','Temple City'],
            factionTypes:['Merchant Guild','Thieves Guild','Mage Circle','Religious Order','Noble House','Military Order','Secret Society','Rebel Alliance'],
            conflictTypes:['succession crisis','border dispute','religious schism','trade war','ancient evil awakening','plague outbreak','dragon threat','demonic incursion'],
            rulerTitles:['King','Queen','Emperor','Empress','High Lord','Arch-Duchess','Grand Magister','Divine Sovereign']
        }
    };
    
    // ============ UTILITIES ============
    const r = a => a[Math.floor(Math.random() * a.length)];
    const cap = s => s.charAt(0).toUpperCase() + s.slice(1).toLowerCase();
    const esc = s => s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    
    // History storage
    let nameHistory = JSON.parse(localStorage.getItem('mythicHistory') || '[]');
    let genNames_ = [];
    let currentBackstoryData = null;
    let currentBackstoryIndex = -1;
    
    function addToHistory(name) {
        nameHistory.unshift({name, time: Date.now()});
        if (nameHistory.length > 100) nameHistory.pop();
        localStorage.setItem('mythicHistory', JSON.stringify(nameHistory));
        updateHistoryBadge();
    }
    
    function updateHistoryBadge() {
        const badge = document.getElementById('historyBadge');
        if (nameHistory.length > 0) {
            badge.textContent = nameHistory.length;
            badge.style.display = 'block';
        } else {
            badge.style.display = 'none';
        }
    }
    
    function confirmClearHistory() {
        if (nameHistory.length === 0) {
            showToast('History is already empty');
            return;
        }
        if (confirm(`Are you sure you want to clear all ${nameHistory.length} names from history?`)) {
            clearHistory();
        }
    }
    
    function clearHistory() {
        nameHistory = [];
        localStorage.setItem('mythicHistory', '[]');
        updateHistoryBadge();
        renderHistory();
        showToast('History cleared');
    }
    
    function renderHistory() {
        const list = document.getElementById('historyList');
        if (nameHistory.length === 0) {
            list.innerHTML = '<div class="empty-state"><p>No names in history yet</p></div>';
            return;
        }
        list.innerHTML = nameHistory.map(h => `<div class="name-item history-item"><div class="name-row"><span class="name-text">${esc(h.name)}</span><span style="font-size:0.8rem;color:var(--text-faded)">${new Date(h.time).toLocaleTimeString()}</span></div><button class="copy-btn" onclick="copyHistoryName(this,'${esc(h.name).replace(/'/g,"\\'")}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button></div>`).join('');
    }
    
    async function copyHistoryName(btn, name) {
        try {
            await navigator.clipboard.writeText(name);
            btn.classList.add('copied');
            showToast('Copied: ' + name);
            setTimeout(() => btn.classList.remove('copied'), 1500);
        } catch(e) {}
    }
    
    // Pronunciation
    function pron(n) {
        const s = n.toLowerCase().replace(/[^a-z]/g, '').match(/[^aeiou]*[aeiou]+[^aeiou]*/gi) || [n];
        const st = Math.floor(s.length / 2);
        return s.map((x, i) => {
            let p = x.replace(/ae/g,'ay').replace(/ei/g,'eye').replace(/ou/g,'ow').replace(/th/g,'th').replace(/ph/g,'f');
            return i === st ? p.toUpperCase() : p;
        }).join('-');
    }
    
    let preferredVoice = null;
    
    function initVoices() {
        const voices = speechSynthesis.getVoices();
        // Prefer natural-sounding voices (order of preference)
        const preferred = [
            'Google UK English Female',
            'Google UK English Male', 
            'Microsoft Zira',
            'Microsoft David',
            'Samantha',
            'Daniel',
            'Karen',
            'Moira',
            'Fiona',
            'en-GB',
            'en-US'
        ];
        
        for (const pref of preferred) {
            const found = voices.find(v => 
                v.name.includes(pref) || v.lang.includes(pref)
            );
            if (found) {
                preferredVoice = found;
                break;
            }
        }
        // Fallback to first English voice
        if (!preferredVoice) {
            preferredVoice = voices.find(v => v.lang.startsWith('en')) || voices[0];
        }
    }
    
    if ('speechSynthesis' in window) {
        speechSynthesis.onvoiceschanged = initVoices;
        initVoices();
    }
    
    function speakName(text) {
        if (!('speechSynthesis' in window)) return;
        
        // Cancel any ongoing speech
        speechSynthesis.cancel();
        
        // Process name for more natural pronunciation
        let processed = text
            .replace(/-/g, ' ')
            .replace(/([a-z])([A-Z])/g, '$1 $2') // Split camelCase
            .replace(/'/g, '') // Remove apostrophes
            .replace(/ae/gi, 'ay') // Common fantasy sounds
            .replace(/th([aeiou])/gi, 'th$1') // Soften th
            .replace(/([^aeiou])yr/gi, '$1eer') // yr -> eer
            .replace(/wyn/gi, 'win')
            .replace(/gn([aeiou])/gi, 'n$1') // Silent g
            .replace(/([aeiou])ii/gi, '$1ee') // Double i
            .replace(/x([aeiou])/gi, 'z$1') // Soften x before vowels
            .toLowerCase();
        
        const utterance = new SpeechSynthesisUtterance(processed);
        
        // Use preferred voice if found
        if (preferredVoice) {
            utterance.voice = preferredVoice;
        }
        
        // Natural speech settings
        utterance.rate = 0.75; // Slower for clarity
        utterance.pitch = 1.05; // Slightly higher sounds more natural
        utterance.volume = 0.9;
        
        speechSynthesis.speak(utterance);
    }
    
    function getMeaning(style) {
        const meanings = {
            fantasy:['star walker','shadow dancer','light bringer','dream weaver','storm caller','moon child','fire heart','wind rider'],
            dnd:['dragon slayer','spell weaver','oath keeper','blade master','shadow stalker','rune bearer','fate touched'],
            dark:['soul reaper','night walker','doom bringer','blood drinker','death whisper','void touched','shadow born'],
            default:['noble one','brave heart','swift blade','keen eye','true soul','wild spirit','ancient blood']
        };
        return r(meanings[style] || meanings.default);
    }
    
    // ============ NAME GENERATION ============
    function baseName(style, gender) {
        const sd = D.styles[style] || D.styles.fantasy;
        let n = r(sd.pre);
        if (Math.random() > 0.35 && sd.mid.length && sd.mid[0]) n += r(sd.mid);
        const gk = gender === 'any' ? r(['m','f','n']) : gender[0];
        n += r(sd.suf[gk] || sd.suf.n || sd.suf.m);
        return cap(n);
    }
    
    function lastName(style) {
        const sd = D.styles[style] || D.styles.fantasy;
        let n = r(sd.pre);
        if (Math.random() > 0.5 && sd.mid.length && sd.mid[0]) n += r(sd.mid);
        n += r(sd.suf.m);
        return cap(n);
    }
    
    function raceName(race, gender) {
        const rd = D.races[race] || D.races.human;
        let n = r(rd.pre);
        if (Math.random() > 0.4 && rd.mid.length) n += r(rd.mid);
        const gk = gender === 'any' ? r(['m','f','n']) : gender[0];
        n += r(rd.suf[gk] || rd.suf.n);
        return cap(n);
    }
    
    function genNames(opts) {
        const {cat, style, gender, length, count, classType, keywords} = opts;
        const names = [];
        const seen = new Set();
        
        // Easter egg: Check for bmatt or rodaky keywords
        const kw = (keywords || '').toLowerCase();
        const ridiculousMode = kw.includes('bmatt') || kw.includes('rodaky');
        
        if (ridiculousMode) {
            showToast('ü§™ RIDICULOUS MODE ACTIVATED!');
            return generateRidiculousNames(count, cat, gender);
        }
        
        for (let i = 0; i < count * 3 && names.length < count; i++) {
            let name, attempts = 0;
            do {
                if (cat === 'characters') {
                    name = baseName(style, gender);
                    if (Math.random() > 0.4) name += ' ' + lastName(style);
                } else if (cat === 'kingdoms') {
                    name = cap(r(D.styles[style]?.pre || D.styles.fantasy.pre) + r(['ia','land','or','heim','gar','oria','ium','dale','mark','hold']));
                } else if (cat === 'ships') {
                    name = 'The ' + r(['Swift','Bold','Silver','Golden','Dark','Storm','Sea','Iron','Crimson','Shadow']) + ' ' + r(['Dragon','Serpent','Wave','Wind','Star','Dawn','Maiden','Queen','Fury','Fortune']);
                } else if (cat === 'taverns') {
                    name = 'The ' + r(['Prancing','Sleeping','Golden','Silver','Rusty','Jolly','Drunken','Lucky','Dancing','Wandering']) + ' ' + r(['Pony','Dragon','Griffin','Knight','Maiden','Tankard','Sword','Crown','Raven','Oak']);
                } else if (cat === 'weapons') {
                    name = baseName(style, 'n') + ', ' + r(['Blade','Sword','Axe','Hammer','Bow','Spear','Staff','Dagger']) + ' of ' + r(['Doom','Light','Shadow','Fire','Ice','Thunder','Death','Glory','Eternity']);
                } else if (cat === 'spells') {
                    name = baseName(style, 'n') + "'s " + r(['Fire','Ice','Shadow','Light','Thunder','Arcane','Divine','Chaos']) + ' ' + r(['Bolt','Blast','Wave','Shield','Storm','Touch','Binding','Word']);
                } else if (cat === 'guilds') {
                    name = 'The ' + r(['Silver','Golden','Iron','Crimson','Shadow','Azure','Emerald','Obsidian']) + ' ' + r(['Hand','Eye','Blade','Shield','Crown','Circle','Order','Legion']);
                } else if (cat === 'artifacts') {
                    name = 'The ' + r(['Crown','Ring','Orb','Scepter','Amulet','Tome','Eye','Heart']) + ' of ' + baseName(style, 'n');
                } else if (cat === 'dungeons') {
                    name = r(['The','']) + ' ' + r(['Forgotten','Dark','Ancient','Cursed','Hidden','Lost','Sunken','Haunted']) + ' ' + r(['Crypt','Dungeon','Tomb','Cavern','Temple','Keep','Ruins','Lair']) + ' of ' + baseName(style,'n');
                } else if (cat === 'titles') {
                    name = r(['The','']) + ' ' + baseName(style,gender) + ' the ' + r(['Brave','Wise','Terrible','Magnificent','Cunning','Mighty','Silent','Undying','Betrayer','Redeemer']);
                } else {
                    name = baseName(style, gender);
                }
                attempts++;
            } while (attempts < 20 && !checkLength(name, length));
            
            if (!seen.has(name.toLowerCase())) {
                seen.add(name.toLowerCase());
                const nm = {name, pron: pron(name), mean: '"' + getMeaning(style) + '"'};
                nm.backstory = genBackstoryForName(name);
                names.push(nm);
                addToHistory(name);
            }
        }
        return names;
    }
    
    // Ridiculous Names Easter Egg for bmatt/rodaky
    function generateRidiculousNames(count, cat, gender) {
        const ridiculousFirstNames = [
            'Bumblefart', 'Wizzlebottom', 'Dingleberry', 'Snorkelwhack', 'Fluffernutter',
            'Sporkington', 'Wobblecheeks', 'Noodlebrain', 'Gigglemuffin', 'Squeakybuns',
            'Tootswaddle', 'Picklenose', 'Bumblebiscuit', 'Wafflebutt', 'Snickerdoodle',
            'Flibbertigibbet', 'Wobbleknees', 'Derpington', 'Goofygoober', 'Sillypants',
            'Chonkmaster', 'Boogerface', 'Stinkybeard', 'Fartblaster', 'Poopsmith',
            'Wigglebottom', 'Noodlearms', 'Buttercup', 'Sprinkletoes', 'Jigglypuff',
            'Blunderbuss', 'Clumsyfoot', 'Dimwit', 'Dorkface', 'Fumblefingers',
            'Goobersnatch', 'Honkmaster', 'Lumpkin', 'Meatball', 'Nuggethead',
            'Oopsiedaisy', 'Pudding', 'Quirkmaster', 'Rumpelstumper', 'Snortface',
            'Taterhead', 'Uglyknees', 'Vomitcomet', 'Weirdo', 'Yoloswag', 'Zitface'
        ];
        
        const ridiculousLastNames = [
            'McStupidface', 'von Dinglehopper', 'the Constipated', 'Thunderthighs', 'Boogerbreath',
            'McFartsalot', 'Buttwhistle', 'Crotchrot', 'Droolmaster', 'Earwaxington',
            'Fungustoe', 'Gassypants', 'Hairball', 'Itchybottom', 'Jerkface',
            'Knucklehead', 'Loserface', 'Mucusmaster', 'Nosepicker', 'Odorbutt',
            'Pimplepopper', 'Queefington', 'Rancidbreath', 'Snot-rocket', 'Toesucker',
            'Underpants', 'Vomitbreath', 'Wetwilly', 'Yuckmouth', 'Zitpopper',
            'the Flatulent', 'the Incompetent', 'the Obnoxious', 'the Smelly', 'the Useless',
            'Clumsybottom', 'Failsworth', 'Losertown', 'Messypants', 'Oopsington'
        ];
        
        const ridiculousTitles = [
            'Professional Couch Potato', 'Supreme Overlord of Nothing', 'Champion of Bad Decisions',
            'Master of Disaster', 'Lord of the Dance (But Badly)', 'Duke of Dumb', 'Baron of Blunders',
            'Earl of Embarrassment', 'Viscount of Very Bad Ideas', 'Marquis of Mediocrity',
            'Knight of the Awkward Silence', 'Guardian of the Last Slice', 'Protector of the TV Remote',
            'Defender of Procrastination', 'Hero of Zero Accomplishments', 'Sage of Snacking',
            'Oracle of Obvious Things', 'Prophet of Poor Choices', 'Wizard of Doing Nothing',
            'Paladin of Pajamas', 'Ranger of the Refrigerator', 'Cleric of Complaining',
            'Bard of Bad Jokes', 'Rogue of Really Bad Ideas', 'Warlock of Wasting Time'
        ];
        
        const ridiculousBackstories = [
            "was born during a total eclipse of common sense. Their mother took one look and said 'well, that's unfortunate.' They've been disappointing people ever since.",
            "once tried to fight a duck and lost. The duck now rules a small kingdom. They don't like to talk about it.",
            "accidentally burned down three villages trying to make toast. They're now banned from kitchens across the realm.",
            "claims to have slain a dragon, but witnesses say it was actually a large chicken. A very angry chicken.",
            "was raised by wolves, but the wolves eventually asked them to leave because they were 'too weird, even for wolves.'",
            "spent ten years training to be a wizard, only to discover they're allergic to magic. They sneeze fireballs now.",
            "once got lost in their own house for three days. Search parties were involved.",
            "has a nemesis: a particularly aggressive goose named Gerald. Gerald is winning.",
            "tried to become a bard but was banned from every tavern for singing too badly. Even the deaf complained.",
            "accidentally started a cult. They didn't mean to. It just sort of happened. The cult worships cheese.",
            "was cursed by a witch to always trip at the worst possible moment. Stairs are their mortal enemy.",
            "believes they're the chosen one. Chosen for what? Nobody knows. Probably something embarrassing.",
            "once challenged Death to a game and chose Tic-Tac-Toe. They still lost somehow.",
            "has been struck by lightning seventeen times. They're either very unlucky or the sky just hates them.",
            "tried to ride a dragon but got the wrong end. The dragon was equally traumatized."
        ];
        
        const ridiculousTraits = [
            'Chronically flatulent', 'Pathologically honest about the wrong things', 'Allergic to success',
            'Weaponized incompetence', 'Uncontrollable eyebrow waggling', 'Speaks only in puns',
            'Falls up stairs', 'Magnetically attracted to bird droppings', 'Cannot whisper',
            'Involuntary jazz hands', 'Sweats profusely when lying', 'Sneezes at plot-critical moments',
            'Constantly hungry', 'Afraid of butterflies', 'Talks to inanimate objects',
            'Terrible sense of direction', 'Laughs at inappropriate times', 'Cannot keep secrets'
        ];
        
        const ridiculousWeapons = [
            'Wet Noodle of Destiny', 'Rubber Chicken of Chaos', 'Spork of Doom',
            'Slightly Stale Baguette', 'Sock Puppet of Terror', 'Aggressive Kazoo',
            'Squeaky Hammer', 'Banana of Justice', 'Deadly Pillow', 'Sarcasm (weaponized)',
            'Disappointment (inherited)', 'Bad Jokes', 'Aggressive Hugging', 'Flailing Wildly',
            'Running Away (very fast)', 'Crying Uncontrollably', 'Sheer Luck'
        ];
        
        const names = [];
        for (let i = 0; i < count; i++) {
            const firstName = r(ridiculousFirstNames);
            const lastName = r(ridiculousLastNames);
            const title = r(ridiculousTitles);
            const name = firstName + ' ' + lastName;
            const backstoryIntro = r(ridiculousBackstories);
            const trait = r(ridiculousTraits);
            const weapon = r(ridiculousWeapons);
            
            const fullBackstory = `${name}, ${title}, ${backstoryIntro}\n\nTheir signature move is called "The Accident" because that's what everything they do turns into. Fellow adventurers describe them as "an experience" and "technically not a war crime."\n\nDespite all evidence to the contrary, they remain convinced that greatness is just around the corner. It isn't. But don't tell them that.`;
            
            names.push({
                name: name,
                pron: firstName.toLowerCase() + ' ' + lastName.split(' ')[0].toLowerCase(),
                mean: '"' + title + '"',
                backstory: {
                    name: name,
                    cls: r(['Village Idiot', 'Professional Disappointment', 'Chaos Agent', 'Walking Disaster', 'Certified Clown', 'Hot Mess', 'Disaster Artist']),
                    gender: gender === 'any' ? r(['Masculine', 'Feminine', 'Questionable']) : cap(gender),
                    wep: weapon,
                    trait: trait,
                    back: fullBackstory,
                    faction: { name: r(['The Losers Club', 'The Magnificent Idiots', 'Team Rocket But Worse', 'The Fellowship of the Wrong Turn', 'Dumb & Dumber Inc.']), role: r(['Mascot', 'Liability', 'Comic Relief', 'The One We Don\'t Talk About', 'Designated Distraction']) }
                }
            });
        }
        return names;
    }
    
    function checkLength(name, len) {
        const l = name.replace(/[^a-zA-Z]/g,'').length;
        if (len === 'short') return l <= 7;
        if (len === 'medium') return l >= 5 && l <= 12;
        if (len === 'long') return l >= 10;
        return true;
    }
    
    // ============ BACKSTORY GENERATION ============
    function genBackstoryForName(name) {
        const bd = D.back;
        const gn = Math.random() > 0.5 ? 'feminine' : 'masculine';
        const pronoun = gn === 'feminine' ? 'she' : 'he';
        const pPoss = gn === 'feminine' ? 'her' : 'his';
        const pObj = gn === 'feminine' ? 'her' : 'him';
        
        const classes = Object.keys(D.cls);
        const cl = r(classes);
        const cd = D.cls[cl];
        
        const faction = r(bd.faction);
        const factionRole = r(faction.role);
        const hasFaction = Math.random() > 0.4;
        
        let back = r(bd.origin) + ', ' + name + ' ' + r(bd.childhood).toLowerCase() + ' ';
        back += '\n\nIn ' + pPoss + ' youth, ' + pronoun + ' ' + r(bd.event) + '. ' + r(bd.turning) + ' ';
        back += '\n\n' + r(bd.trait) + ', ' + pronoun + ' wields a ' + r(cd.wep) + ' with ' + r(cd.tr) + ' determination. ';
        if (hasFaction) {
            back += 'As a ' + factionRole + ' of ' + faction.name + ', ' + faction.desc + ', ' + pronoun + ' has resources but also obligations. ';
        }
        back += '\n\n' + r(bd.secret) + ' Those who know ' + pObj + ' have noticed that ' + r(bd.flaw).toLowerCase() + ' ';
        back += '\n\n' + r(bd.motive) + ' ' + r(bd.goal);
        
        return {name, cls: cap(cl), gender: cap(gn), wep: cap(r(cd.wep)), trait: cap(r(cd.tr)), faction: hasFaction ? {name: faction.name, role: cap(factionRole)} : null, back};
    }
    
    // ============ PARTY GENERATOR ============
    function generateParty() {
        const size = parseInt(document.getElementById('partySize').value);
        const comp = document.getElementById('partyComp').value;
        const style = document.getElementById('partyStyle').value;
        
        const roles = {
            balanced: ['warrior','mage','rogue','cleric','ranger','bard'],
            combat: ['warrior','warrior','barbarian','paladin','ranger','cleric'],
            stealth: ['rogue','rogue','ranger','bard','monk','warlock'],
            magic: ['mage','warlock','cleric','druid','bard','necromancer'],
            random: Object.keys(D.cls)
        };
        
        const available = [...roles[comp]];
        const party = [];
        
        // Generate base party members
        for (let i = 0; i < size; i++) {
            const role = available.length ? available.splice(Math.floor(Math.random()*available.length),1)[0] : r(Object.keys(D.cls));
            const gender = r(['masculine','feminine']);
            const name = baseName(style, gender) + ' ' + lastName(style);
            const cd = D.cls[role] || D.cls.warrior;
            party.push({name, role, gender, wep: r(cd.wep), trait: r(cd.tr), race: 'human'});
        }
        
        // Generate relationships
        const relationships = [];
        if (party.length >= 2) {
            relationships.push({a: 0, b: 1, type: r(D.relationships.positive), typeCategory: 'positive'});
        }
        if (party.length >= 3) {
            relationships.push({a: 1, b: 2, type: r(D.relationships.negative), typeCategory: 'negative'});
        }
        if (party.length >= 4 && Math.random() > 0.5) {
            relationships.push({a: 0, b: 3, type: r(D.relationships.romantic), typeCategory: 'romantic'});
        }
        if (party.length >= 5) {
            relationships.push({a: 2, b: 4, type: r(D.relationships.positive), typeCategory: 'positive'});
        }
        if (party.length >= 6) {
            relationships.push({a: 3, b: 5, type: r(D.relationships.negative), typeCategory: 'negative'});
        }
        
        // Generate interconnected backstories
        generatePartyBackstories(party, relationships);
        
        renderParty(party, relationships);
    }
    
    function generatePartyBackstories(party, relationships) {
        const bd = D.back;
        const sharedOrigins = [
            'the same war-torn village',
            'an orphanage in the capital',
            'a traveling merchant caravan',
            'the siege of Thornhold',
            'the great fire of Ashenmoor',
            'the guild halls of the Silver Company',
            'a shipwreck on the Sword Coast',
            'imprisonment in the Iron Keep'
        ];
        const sharedEvents = [
            'survived a dragon attack together',
            'escaped a cult\'s ritual sacrifice',
            'were framed for a crime they didn\'t commit',
            'discovered an ancient map leading to treasure',
            'witnessed the assassination of a noble',
            'were rescued from slavers by the same knight',
            'found themselves bound by a mysterious curse'
        ];
        const partyFormation = [
            'A chance meeting at a crossroads tavern',
            'A desperate plea from a dying messenger',
            'A bounty notice that caught everyone\'s eye',
            'An explosion that threw them together‚Äîliterally',
            'A shared cell in a dungeon beneath the city',
            'A mysterious letter each received on the same night'
        ];
        
        const sharedOrigin = r(sharedOrigins);
        const sharedEvent = r(sharedEvents);
        const formation = r(partyFormation);
        
        // Build relationship map for each character
        const relMap = {};
        party.forEach((_, i) => relMap[i] = []);
        relationships.forEach(rel => {
            relMap[rel.a].push({other: rel.b, type: rel.type, category: rel.typeCategory});
            relMap[rel.b].push({other: rel.a, type: rel.type, category: rel.typeCategory});
        });
        
        party.forEach((member, i) => {
            const cd = D.cls[member.role] || D.cls.warrior;
            const gn = member.gender;
            const pronoun = gn === 'masculine' ? 'he' : 'she';
            const pPoss = gn === 'masculine' ? 'his' : 'her';
            const pObj = gn === 'masculine' ? 'him' : 'her';
            const firstName = member.name.split(' ')[0];
            
            let back = '';
            
            // Origin - some share origins based on relationships
            const hasPositiveRel = relMap[i].find(r => r.category === 'positive' || r.category === 'romantic');
            if (hasPositiveRel && Math.random() > 0.4) {
                const otherName = party[hasPositiveRel.other].name.split(' ')[0];
                back += `${firstName} and ${otherName} both hail from ${sharedOrigin}. `;
            } else {
                back += r(bd.origin) + ', ' + firstName + ' ' + r(bd.childhood).toLowerCase() + ' ';
            }
            
            // Class-specific training
            back += `\n\n${cap(pronoun)} trained as a ${member.role}, mastering the ${member.wep} through ${r(['years of discipline','harsh necessity','a legendary mentor\'s guidance','blood and sacrifice'])}. `;
            
            // Relationship-specific story beats
            relMap[i].forEach(rel => {
                const otherMember = party[rel.other];
                const otherFirst = otherMember.name.split(' ')[0];
                
                if (rel.category === 'positive') {
                    const bonds = [
                        `${otherFirst} saved ${pObj} during ${r(['a goblin ambush','a bar brawl gone wrong','a near-fatal illness','a bandit raid'])}‚Äîa debt ${pronoun} intends to repay.`,
                        `${pronoun} and ${otherFirst} ${sharedEvent}, forging an unbreakable bond.`,
                        `${otherFirst} is the only one who knows ${pPoss} true identity.`,
                        `They trained together under the same master, and ${pronoun} considers ${otherFirst} ${gn === 'masculine' ? 'a brother' : 'a sister'} in all but blood.`
                    ];
                    back += r(bonds) + ' ';
                } else if (rel.category === 'negative') {
                    const tensions = [
                        `${pronoun} and ${otherFirst} clash constantly‚Äîtheir methods couldn't be more different.`,
                        `${otherFirst} reminds ${pObj} of someone ${pronoun}'d rather forget.`,
                        `There's unfinished business between ${pObj} and ${otherFirst}, a slight neither has forgiven.`,
                        `${pronoun} doesn't trust ${otherFirst}'s judgment, not since ${r(['the incident in Millford','they nearly got the party killed','that betrayal years ago'])}.`
                    ];
                    back += r(tensions) + ' ';
                } else if (rel.category === 'romantic') {
                    const romance = [
                        `What started as rivalry with ${otherFirst} has become something ${pronoun} doesn't fully understand‚Äîor won't admit.`,
                        `${pronoun} would follow ${otherFirst} into the Abyss itself, though ${pronoun}'d never say so aloud.`,
                        `The stolen glances between ${pObj} and ${otherFirst} haven't gone unnoticed by the party.`,
                        `${otherFirst} is the reason ${pronoun} stays with this group, though ${pronoun} pretends otherwise.`
                    ];
                    back += r(romance) + ' ';
                }
            });
            
            // Personal secret/flaw
            back += `\n\n${r(bd.secret)} `;
            back += r(bd.flaw) + ' ';
            
            // Party-connected goal
            const partyGoals = [
                `${pronoun} joined this band of adventurers seeking ${r(['redemption','fortune','purpose','answers'])}.`,
                `${formation} brought ${pObj} to these companions, and ${pronoun}'s stayed ever since.`,
                `${pronoun} believes this party is ${pPoss} best chance to ${r(['find the artifact','avenge the fallen','clear their name','break the curse'])}.`,
                `For now, ${pPoss} fate is tied to these adventurers‚Äîfor better or worse.`
            ];
            back += `\n\n${r(partyGoals)}`;
            
            member.backstory = back;
        });
    }
    
    function renderParty(party, relationships) {
        const cont = document.getElementById('partyContainer');
        let html = '<div class="party-grid">';
        party.forEach((m, i) => {
            const portraitSmall = generatePortraitSmall(m.race || 'human', m.role);
            html += `<div class="party-member ${m.role}" style="animation-delay:${i*0.1}s" onclick="openPartyMemberBackstory(${i})">
                <div class="party-member-header">${portraitSmall}<div class="party-member-role">${cap(m.role)}</div></div>
                <div class="party-member-name">${esc(m.name)}</div>
                <div class="party-member-info">${cap(m.gender)} ‚Ä¢ ${cap(m.wep)}<br><em>${cap(m.trait)}</em></div>
                <div class="party-member-preview">${m.backstory ? esc(m.backstory.substring(0, 80)) + '...' : ''}</div>
                <div class="party-member-actions">
                    <button class="party-card-btn" onclick="event.stopPropagation();createPartyMemberCard(${i})" title="Create Share Card">üñºÔ∏è</button>
                    <button class="party-read-more" onclick="event.stopPropagation();openPartyMemberBackstory(${i})">Read backstory ‚Üí</button>
                </div>
            </div>`;
            addToHistory(m.name);
        });
        html += '</div>';
        
        if (relationships.length) {
            html += '<div class="party-relationships"><h3>üîó Party Dynamics</h3>';
            relationships.forEach(rel => {
                const iconMap = {positive: 'üíö', negative: '‚öîÔ∏è', romantic: 'üíï'};
                html += `<div class="relationship-item">${iconMap[rel.typeCategory] || 'üîó'} <strong>${party[rel.a].name.split(' ')[0]}</strong> & <strong>${party[rel.b].name.split(' ')[0]}</strong>: <span class="relationship-type">${rel.type}</span></div>`;
            });
            html += '</div>';
        }
        
        html += '<div class="share-buttons"><button class="share-btn" onclick="copyParty()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy Party</button><button class="share-btn twitter" onclick="sharePartyTwitter()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>Tweet</button></div>';
        
        cont.innerHTML = html;
        
        // Store party data for modal access
        window.currentParty = party;
        window.currentPartyRelationships = relationships;
    }
    
    function openPartyMemberBackstory(index) {
        const member = window.currentParty[index];
        if (!member) return;
        
        currentBackstoryData = {
            name: member.name,
            cls: cap(member.role),
            gender: cap(member.gender),
            wep: cap(member.wep),
            trait: cap(member.trait),
            back: member.backstory,
            faction: null
        };
        currentBackstoryIndex = -1;
        
        renderBackstoryModal();
        document.getElementById('backstoryModal').classList.add('show');
        document.body.style.overflow = 'hidden';
    }
    
    function createPartyMemberCard(index) {
        const member = window.currentParty[index];
        if (!member) return;
        
        openShareCard({
            name: member.name,
            gender: cap(member.gender),
            race: cap(member.race || 'Human'),
            cls: cap(member.role),
            wep: cap(member.wep),
            trait: cap(member.trait),
            back: member.backstory
        });
    }
    
    // ============ WORLD BUILDER ============
    function generateWorld() {
        const type = document.getElementById('worldType').value;
        const size = document.getElementById('worldSize').value;
        const conflict = document.getElementById('worldConflict').value;
        
        const cityCounts = {small: 3, medium: 5, large: 8};
        const cityCount = cityCounts[size];
        
        const kingdomName = cap(r(D.styles.medieval.pre) + r(['ia','heim','land','or','mark','dale','gar']));
        const rulerTitle = r(D.world.rulerTitles);
        const rulerName = baseName('medieval', Math.random()>0.5?'masculine':'feminine') + ' ' + lastName('medieval');
        
        const cities = [];
        for (let i = 0; i < cityCount; i++) {
            cities.push({
                name: cap(r(D.styles.medieval.pre) + r(['ford','ton','heim','haven','gate','bridge','keep','hollow'])),
                type: r(D.world.cityTypes),
                leader: baseName('medieval', r(['m','f']))
            });
        }
        
        const factions = [];
        const factionCount = Math.min(3, Math.floor(cityCount/2)+1);
        for (let i = 0; i < factionCount; i++) {
            factions.push({
                name: 'The ' + r(['Silver','Golden','Iron','Crimson','Shadow']) + ' ' + r(['Hand','Eye','Order','Circle','Guild']),
                type: r(D.world.factionTypes),
                leader: baseName('medieval', r(['m','f'])) + ' ' + lastName('medieval')
            });
        }
        
        const conflicts = [];
        if (conflict !== 'peaceful') {
            conflicts.push(r(D.world.conflictTypes));
            if (conflict === 'war') conflicts.push(r(D.world.conflictTypes));
        }
        
        renderWorld({kingdomName, rulerTitle, rulerName, type, cities, factions, conflicts});
    }
    
    function renderWorld(w) {
        const cont = document.getElementById('worldContainer');
        let html = '<div class="world-container">';
        
        html += `<div class="world-kingdom"><div class="world-kingdom-name">üëë ${esc(w.kingdomName)}</div><div class="world-kingdom-type">${cap(w.type)} ruled by ${w.rulerTitle} ${esc(w.rulerName)}</div></div>`;
        
        html += '<div class="world-section"><h3>üè∞ Cities & Settlements</h3><div class="world-grid">';
        w.cities.forEach(c => {
            html += `<div class="world-item"><div class="world-item-name">${esc(c.name)}</div><div class="world-item-desc">${c.type} ‚Ä¢ Led by ${esc(c.leader)}</div></div>`;
            addToHistory(c.name);
        });
        html += '</div></div>';
        
        html += '<div class="world-section"><h3>‚öîÔ∏è Factions & Powers</h3><div class="world-grid">';
        w.factions.forEach(f => {
            html += `<div class="world-item"><div class="world-item-name">${esc(f.name)}</div><div class="world-item-desc">${f.type} ‚Ä¢ ${esc(f.leader)}</div></div>`;
        });
        html += '</div></div>';
        
        if (w.conflicts.length) {
            html += '<div class="world-section"><h3>üî• Active Conflicts</h3><div class="world-grid">';
            w.conflicts.forEach(c => {
                html += `<div class="world-item" style="border-left-color:var(--accent-ember)"><div class="world-item-name">${cap(c)}</div></div>`;
            });
            html += '</div></div>';
        }
        
        html += '</div>';
        cont.innerHTML = html;
        addToHistory(w.kingdomName);
    }

    // ============ DISPLAY FUNCTIONS ============
    function displayNames(names, cont = document.getElementById('resultsContainer')) {
        genNames_ = names;
        document.getElementById('resultsHeader').style.display = 'flex';
        document.getElementById('resultsCount').textContent = names.length;
        document.getElementById('copyAllBtn').style.display = 'inline-flex';
        
        // Reset compare selection when new names generated
        clearCompare();
        
        cont.innerHTML = '<div class="names-list">' + names.map((it, i) => {
            const previewText = it.backstory.back.split('\n\n')[0].substring(0, 140) + '...';
            const rarity = calculateRarity(it.name);
            const rarityInfo = getRarityTier(rarity);
            const compareModeClass = compareMode ? 'compare-mode' : '';
            
            return `<div class="name-item ${compareModeClass}" style="animation-delay:${i*0.03}s" onclick="if(compareMode){toggleCompareItem('${esc(it.name).replace(/'/g,"\\'")}',${i})}">
                <div class="name-row">
                    <div class="name-main">
                        <span class="name-text">${esc(it.name)}</span>
                        <span class="rarity-badge ${rarityInfo.cls}" title="Rarity: ${rarity}%">${rarityInfo.label}</span>
                        <span class="name-pronunciation" onclick="event.stopPropagation();speakName('${esc(it.name)}')">${it.pron} <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"/></svg></span>
                        <span class="name-meaning">${it.mean}</span>
                    </div>
                    <div class="name-actions">
                        <button class="share-card-btn" onclick="event.stopPropagation();createCardFromList(${i})" title="Create Share Card">üñºÔ∏è Card</button>
                        <button class="action-btn" onclick="event.stopPropagation();toggleFavorite(this,'${esc(it.name).replace(/'/g,"\\'")}')" title="Favorite"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg></button>
                        <button class="copy-btn" onclick="event.stopPropagation();copyN(this,'${esc(it.name).replace(/'/g,"\\'")}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></button>
                    </div>
                </div>
                <div class="name-preview">
                    <div class="name-preview-text">${esc(previewText)}</div>
                    <button class="name-expand" onclick="event.stopPropagation();openBackstoryFromList(${i})">Read full backstory ‚Üí</button>
                </div>
            </div>`;
        }).join('') + '</div>';
    }
    
    function createCardFromList(index) {
        const item = genNames_[index];
        const cat = document.getElementById('category')?.value || 'characters';
        const raceMap = {elf:'elf',dwarf:'dwarf',orc:'orc',tiefling:'tiefling',dragonborn:'dragonborn',halfling:'halfling',gnome:'gnome',human:'human'};
        const race = raceMap[cat] || 'Human';
        
        openShareCard({
            name: item.name,
            gender: item.backstory.gender,
            race: race.charAt(0).toUpperCase() + race.slice(1),
            cls: item.backstory.cls,
            wep: item.backstory.wep,
            trait: item.backstory.trait,
            back: item.backstory.back
        });
    }
    
    function createCardFromModal() {
        const d = currentBackstoryData;
        const cat = document.getElementById('category')?.value || 'characters';
        const raceMap = {elf:'Elf',dwarf:'Dwarf',orc:'Orc',tiefling:'Tiefling',dragonborn:'Dragonborn',halfling:'Halfling',gnome:'Gnome',human:'Human'};
        const race = raceMap[cat] || 'Human';
        
        closeModal();
        openShareCard({
            name: d.name,
            gender: d.gender,
            race: race,
            cls: d.cls,
            wep: d.wep,
            trait: d.trait,
            back: d.back
        });
    }
    
    function toggleFavorite(btn, name) {
        btn.classList.toggle('favorited');
        if (btn.classList.contains('favorited')) {
            btn.querySelector('svg').setAttribute('fill', 'currentColor');
            showToast('Added to favorites');
        } else {
            btn.querySelector('svg').setAttribute('fill', 'none');
        }
    }
    
    // ============ MODAL & SHARING ============
    function openBackstoryFromList(index) {
        currentBackstoryIndex = index;
        currentBackstoryData = genNames_[index].backstory;
        renderBackstoryModal();
        document.getElementById('backstoryModal').classList.add('show');
        document.body.style.overflow = 'hidden';
    }
    
    function renderBackstoryModal() {
        const d = currentBackstoryData;
        // Determine race from current category selection or default to human
        const cat = document.getElementById('category')?.value || 'characters';
        const raceMap = {elf:'elf',dwarf:'dwarf',orc:'orc',tiefling:'tiefling',dragonborn:'dragonborn',halfling:'halfling',gnome:'gnome'};
        const race = raceMap[cat] || 'human';
        
        const portraitHtml = generatePortraitSmall(race, d.cls);
        
        document.getElementById('modalTitle').innerHTML = portraitHtml + '<span>' + esc(d.name) + '</span>';
        let statsHtml = `<div class="modal-stats">
            <div class="modal-stat"><div class="modal-stat-label">Class</div><div class="modal-stat-value">${d.cls}</div></div>
            <div class="modal-stat"><div class="modal-stat-label">Gender</div><div class="modal-stat-value">${d.gender}</div></div>
            <div class="modal-stat"><div class="modal-stat-label">Weapon</div><div class="modal-stat-value">${d.wep}</div></div>
            <div class="modal-stat"><div class="modal-stat-label">Trait</div><div class="modal-stat-value">${d.trait}</div></div>`;
        if (d.faction) {
            statsHtml += `<div class="modal-stat"><div class="modal-stat-label">Faction</div><div class="modal-stat-value">${d.faction.name}</div></div>
            <div class="modal-stat"><div class="modal-stat-label">Role</div><div class="modal-stat-value">${d.faction.role}</div></div>`;
        }
        statsHtml += '</div>';
        document.getElementById('modalBody').innerHTML = statsHtml + d.back.split('\n\n').map(p => '<p>' + p + '</p>').join('');
    }
    
    function closeModal() {
        document.getElementById('backstoryModal').classList.remove('show');
        document.body.style.overflow = '';
    }
    
    function regenerateBackstory() {
        currentBackstoryData = genBackstoryForName(currentBackstoryData.name);
        if (currentBackstoryIndex >= 0 && genNames_[currentBackstoryIndex]) {
            genNames_[currentBackstoryIndex].backstory = currentBackstoryData;
        }
        renderBackstoryModal();
        showToast('Backstory regenerated!');
    }
    
    async function copyBackstory() {
        const d = currentBackstoryData;
        let t = '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n' + d.name.toUpperCase() + '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
        t += 'Class: ' + d.cls + '\nGender: ' + d.gender + '\nWeapon: ' + d.wep + '\nTrait: ' + d.trait + '\n';
        if (d.faction) t += 'Faction: ' + d.faction.name + '\nRole: ' + d.faction.role + '\n';
        t += '\n' + d.back;
        try { await navigator.clipboard.writeText(t); showToast('Backstory copied!'); } catch(e) {}
    }
    
    function shareTwitter() {
        const d = currentBackstoryData;
        const text = `Meet ${d.name}, a ${d.gender.toLowerCase()} ${d.cls.toLowerCase()} who ${d.trait.toLowerCase()}. Created with MythicNames! üé≤`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent('https://mythicnames.io')}`, '_blank');
    }
    
    function shareReddit() {
        const d = currentBackstoryData;
        const title = `[OC] ${d.name} - ${d.cls} Character`;
        window.open(`https://reddit.com/submit?url=${encodeURIComponent('https://mythicnames.io')}&title=${encodeURIComponent(title)}`, '_blank');
    }
    
    async function copyParty() {
        const members = document.querySelectorAll('.party-member');
        let text = 'ADVENTURING PARTY\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
        members.forEach(m => {
            text += m.querySelector('.party-member-name').textContent + ' (' + m.querySelector('.party-member-role').textContent + ')\n';
        });
        try { await navigator.clipboard.writeText(text); showToast('Party copied!'); } catch(e) {}
    }
    
    function sharePartyTwitter() {
        const count = document.querySelectorAll('.party-member').length;
        const text = `Just generated an adventuring party of ${count} heroes with MythicNames! üó°Ô∏è‚öîÔ∏è`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent('https://mythicnames.io')}`, '_blank');
    }
    
    // ============ PRINT & EXPORT ============
    function printResults() {
        window.print();
    }
    
    function exportPDF() {
        showToast('Use Print ‚Üí Save as PDF');
        window.print();
    }
    
    // ============ UTILITIES ============
    function showToast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 2000);
    }
    
    async function copyN(btn, name) {
        try {
            await navigator.clipboard.writeText(name);
            btn.classList.add('copied');
            btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>';
            showToast('Copied: ' + name);
            setTimeout(() => {
                btn.classList.remove('copied');
                btn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
            }, 1500);
        } catch(e) {}
    }
    
    async function copyAll() {
        const names = genNames_.map(n => n.name).join('\n');
        try { await navigator.clipboard.writeText(names); showToast('All names copied!'); } catch(e) {}
    }
    
    // ============ CAMPAIGN MANAGER ============
    let campaigns = JSON.parse(localStorage.getItem('mythicCampaigns') || '[]');
    let activeCampaignId = localStorage.getItem('mythicActiveCampaign') || null;
    
    function createCampaign() {
        const nameInput = document.getElementById('newCampaignName');
        const name = nameInput.value.trim();
        if (!name) { showToast('Enter a campaign name'); return; }
        const campaign = {id: Date.now().toString(), name, created: Date.now(), characters: [], parties: [], worlds: []};
        campaigns.push(campaign);
        saveCampaigns();
        nameInput.value = '';
        renderCampaigns();
        showToast('Campaign created!');
    }
    
    function saveCampaigns() {
        localStorage.setItem('mythicCampaigns', JSON.stringify(campaigns));
        localStorage.setItem('mythicActiveCampaign', activeCampaignId);
    }
    
    function setActiveCampaign(id) {
        activeCampaignId = id;
        saveCampaigns();
        renderCampaigns();
        showToast('Campaign activated!');
    }
    
    function deleteCampaign(id) {
        if (!confirm('Delete this campaign?')) return;
        campaigns = campaigns.filter(c => c.id !== id);
        if (activeCampaignId === id) activeCampaignId = null;
        saveCampaigns();
        renderCampaigns();
    }
    
    function addToCampaign(type, data) {
        if (!activeCampaignId) { showToast('Select a campaign first'); return false; }
        const campaign = campaigns.find(c => c.id === activeCampaignId);
        if (!campaign) return false;
        if (type === 'character') campaign.characters.push(data);
        else if (type === 'party') campaign.parties.push(data);
        else if (type === 'world') campaign.worlds.push(data);
        saveCampaigns();
        showToast('Added to ' + campaign.name);
        return true;
    }
    
    function renderCampaigns() {
        const cont = document.getElementById('campaignList');
        if (!campaigns.length) {
            cont.innerHTML = '<div class="empty-state"><div class="empty-icon">üìö</div><p>No campaigns yet</p></div>';
            return;
        }
        cont.innerHTML = campaigns.map(c => {
            const isActive = c.id === activeCampaignId;
            return `<div class="campaign-card ${isActive ? 'active' : ''}"><div class="campaign-header"><div><div class="campaign-name">${isActive ? '‚úì ' : ''}${esc(c.name)}</div><div class="campaign-meta">Created ${new Date(c.created).toLocaleDateString()}</div></div><div class="campaign-actions">${!isActive ? `<button class="secondary-btn" onclick="setActiveCampaign('${c.id}')">Activate</button>` : ''}<button class="secondary-btn" onclick="exportCampaign('${c.id}')">Export</button><button class="secondary-btn" onclick="deleteCampaign('${c.id}')" style="color:var(--accent-ember)">√ó</button></div></div><div class="campaign-content"><div class="campaign-section"><div class="campaign-section-title">Characters</div><div class="campaign-section-count">${c.characters.length}</div></div><div class="campaign-section"><div class="campaign-section-title">Parties</div><div class="campaign-section-count">${c.parties.length}</div></div><div class="campaign-section"><div class="campaign-section-title">Worlds</div><div class="campaign-section-count">${c.worlds.length}</div></div></div></div>`;
        }).join('');
    }
    
    function exportCampaign(id) {
        const campaign = campaigns.find(c => c.id === id);
        if (!campaign) return;
        const blob = new Blob([JSON.stringify(campaign, null, 2)], {type: 'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob);
        a.download = campaign.name.replace(/[^a-z0-9]/gi, '-') + '.json'; a.click();
    }
    
    // ============ SHARE CARD ============
    let shareCardData = null;
    
    function openShareCard(data) {
        shareCardData = data;
        const canvas = document.getElementById('shareCanvas');
        const ctx = canvas.getContext('2d');
        const W = 500;
        
        // First, calculate how many lines the backstory needs
        ctx.font = '14px Georgia, serif';
        const backstoryText = (data.back || '').replace(/\n+/g, ' ').trim();
        const words = backstoryText.split(' ');
        const maxWidth = 440;
        const lineHeight = 20;
        let tempLine = '';
        let lineCount = 0;
        
        for (let i = 0; i < words.length; i++) {
            const testLine = tempLine + words[i] + ' ';
            const metrics = ctx.measureText(testLine);
            if (metrics.width > maxWidth && tempLine !== '') {
                lineCount++;
                tempLine = words[i] + ' ';
            } else {
                tempLine = testLine;
            }
        }
        if (tempLine.trim()) lineCount++;
        
        // Calculate dynamic height: header(100) + backstory + gap(15) + stats(55) + footer(25)
        const backstoryHeight = Math.max(lineCount * lineHeight, 60);
        const H = 100 + backstoryHeight + 15 + 55 + 25;
        
        // Resize canvas
        canvas.height = H;
        
        // === BACKGROUND ===
        const bgGrad = ctx.createLinearGradient(0, 0, W, H);
        bgGrad.addColorStop(0, '#0f0d0a');
        bgGrad.addColorStop(0.5, '#1a1510');
        bgGrad.addColorStop(1, '#0f0d0a');
        ctx.fillStyle = bgGrad;
        ctx.fillRect(0, 0, W, H);
        
        // Subtle noise texture effect
        ctx.fillStyle = 'rgba(255,255,255,0.02)';
        for (let i = 0; i < 300; i++) {
            ctx.beginPath();
            ctx.arc(Math.random() * W, Math.random() * H, Math.random() * 1.5, 0, Math.PI * 2);
            ctx.fill();
        }
        
        // Corner decorations (top only)
        ctx.strokeStyle = '#d4a857';
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(15, 40); ctx.lineTo(15, 15); ctx.lineTo(40, 15);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(W-40, 15); ctx.lineTo(W-15, 15); ctx.lineTo(W-15, 40);
        ctx.stroke();
        
        // === HEADER SECTION ===
        const orbGrad = ctx.createRadialGradient(W/2, 55, 0, W/2, 55, 120);
        orbGrad.addColorStop(0, 'rgba(212,168,87,0.15)');
        orbGrad.addColorStop(0.5, 'rgba(212,168,87,0.05)');
        orbGrad.addColorStop(1, 'rgba(212,168,87,0)');
        ctx.fillStyle = orbGrad;
        ctx.fillRect(0, 0, W, 120);
        
        // Character name with shadow
        ctx.textAlign = 'center';
        ctx.font = 'bold 32px Georgia, serif';
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.fillText(data.name || 'Unknown', W/2 + 2, 47);
        ctx.fillStyle = '#fff';
        ctx.fillText(data.name || 'Unknown', W/2, 45);
        
        // Subtitle
        const subtitle = [(data.gender || ''), (data.race || ''), (data.cls || '')].filter(Boolean).join('  ¬∑  ');
        ctx.font = '15px Georgia, serif';
        ctx.fillStyle = '#d4a857';
        ctx.fillText('‚Äî ' + subtitle + ' ‚Äî', W/2, 70);
        
        // Decorative line
        const lineGrad = ctx.createLinearGradient(50, 0, W-50, 0);
        lineGrad.addColorStop(0, 'rgba(212,168,87,0)');
        lineGrad.addColorStop(0.2, 'rgba(212,168,87,0.6)');
        lineGrad.addColorStop(0.5, 'rgba(212,168,87,1)');
        lineGrad.addColorStop(0.8, 'rgba(212,168,87,0.6)');
        lineGrad.addColorStop(1, 'rgba(212,168,87,0)');
        ctx.strokeStyle = lineGrad;
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(50, 85);
        ctx.lineTo(W-50, 85);
        ctx.stroke();
        
        // Diamond ornament
        ctx.fillStyle = '#d4a857';
        ctx.beginPath();
        ctx.moveTo(W/2, 80);
        ctx.lineTo(W/2 + 5, 85);
        ctx.lineTo(W/2, 90);
        ctx.lineTo(W/2 - 5, 85);
        ctx.closePath();
        ctx.fill();
        
        // === BACKSTORY SECTION (full text) ===
        ctx.textAlign = 'left';
        ctx.font = '14px Georgia, serif';
        ctx.fillStyle = '#d8d0c4';
        let line = '';
        let y = 110;
        
        for (let i = 0; i < words.length; i++) {
            const testLine = line + words[i] + ' ';
            const metrics = ctx.measureText(testLine);
            if (metrics.width > maxWidth && line !== '') {
                ctx.fillText(line.trim(), 30, y);
                line = words[i] + ' ';
                y += lineHeight;
            } else {
                line = testLine;
            }
        }
        if (line.trim()) {
            ctx.fillText(line.trim(), 30, y);
            y += lineHeight;
        }
        
        // === STATS BAR ===
        const statsY = 100 + backstoryHeight + 15;
        
        ctx.fillStyle = 'rgba(0,0,0,0.4)';
        ctx.fillRect(0, statsY, W, 55);
        
        const edgeGrad = ctx.createLinearGradient(0, statsY, 0, statsY + 5);
        edgeGrad.addColorStop(0, 'rgba(212,168,87,0.4)');
        edgeGrad.addColorStop(1, 'rgba(212,168,87,0)');
        ctx.fillStyle = edgeGrad;
        ctx.fillRect(0, statsY, W, 5);
        
        const stats = [
            { label: 'RACE', value: data.race || '‚Äî' },
            { label: 'CLASS', value: data.cls || '‚Äî' },
            { label: 'WEAPON', value: data.wep || '‚Äî' },
            { label: 'TRAIT', value: data.trait || '‚Äî' }
        ];
        
        const statWidth = W / stats.length;
        stats.forEach((stat, i) => {
            const x = i * statWidth + statWidth / 2;
            
            if (i > 0) {
                ctx.strokeStyle = 'rgba(212,168,87,0.2)';
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.moveTo(i * statWidth, statsY + 8);
                ctx.lineTo(i * statWidth, statsY + 48);
                ctx.stroke();
            }
            
            ctx.textAlign = 'center';
            ctx.font = '9px Arial, sans-serif';
            ctx.fillStyle = '#8a8070';
            ctx.fillText(stat.label, x, statsY + 20);
            
            ctx.font = 'bold 14px Georgia, serif';
            ctx.fillStyle = '#f4e8d4';
            ctx.fillText(stat.value, x, statsY + 40);
        });
        
        // === FOOTER ===
        const footerY = H - 25;
        ctx.fillStyle = '#1a1510';
        ctx.fillRect(0, footerY, W, 25);
        
        ctx.strokeStyle = 'rgba(212,168,87,0.3)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, footerY);
        ctx.lineTo(W, footerY);
        ctx.stroke();
        
        ctx.textAlign = 'left';
        ctx.font = '11px Georgia, serif';
        ctx.fillStyle = '#6a6050';
        ctx.fillText('‚öî  MythicNames.io', 20, footerY + 16);
        
        ctx.textAlign = 'right';
        ctx.fillStyle = '#4a4540';
        ctx.font = '10px Arial, sans-serif';
        ctx.fillText('Fantasy Name Generator', W - 20, footerY + 16);
        
        document.getElementById('shareCardModal').classList.add('show');
    }
    
    function closeShareModal() {
        document.getElementById('shareCardModal').classList.remove('show');
    }
    
    function downloadShareCard() {
        const canvas = document.getElementById('shareCanvas');
        const a = document.createElement('a');
        a.download = (shareCardData?.name || 'character') + '-card.png';
        a.href = canvas.toDataURL('image/png');
        a.click();
    }
    
    function shareCardTwitter() {
        const text = `Check out ${shareCardData?.name}, my new ${shareCardData?.cls || 'character'}! Created with MythicNames üé≤`;
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent('https://mythicnames.io')}`, '_blank');
    }
    
    // ============ CHARACTER PORTRAIT GENERATOR ============
    function generatePortrait(race, cls, gender) {
        const uid = Math.random().toString(36).substr(2, 9);
        
        // Race-themed color palettes
        const raceColors = {
            human: { primary: '#c9a86c', secondary: '#8b7355', accent: '#d4a857' },
            elf: { primary: '#7da88e', secondary: '#4a6b5a', accent: '#a8d4b8' },
            dwarf: { primary: '#a67c52', secondary: '#5c4033', accent: '#d4a857' },
            halfling: { primary: '#c9a86c', secondary: '#6b8e4e', accent: '#e8c47c' },
            gnome: { primary: '#b48be0', secondary: '#6b4a8e', accent: '#d4b8e8' },
            orc: { primary: '#4a6b3a', secondary: '#2d3d25', accent: '#8bc45d' },
            tiefling: { primary: '#8b3a3a', secondary: '#4a1f1f', accent: '#c45d5d' },
            dragonborn: { primary: '#3a5a8b', secondary: '#1f2f4a', accent: '#5d8bc4' }
        };
        const colors = raceColors[race] || raceColors.human;
        
        // Class symbols - elegant line art
        const classSymbols = {
            warrior: `<path d="M50 15 L50 85" stroke="${colors.accent}" stroke-width="3"/><path d="M35 30 L65 30" stroke="${colors.accent}" stroke-width="3"/><path d="M40 75 L50 85 L60 75" fill="none" stroke="${colors.accent}" stroke-width="2"/>`,
            mage: `<path d="M50 15 L53 42 L80 50 L53 58 L50 85 L47 58 L20 50 L47 42 Z" fill="none" stroke="${colors.accent}" stroke-width="2"/><circle cx="50" cy="50" r="8" fill="${colors.accent}" opacity="0.3"/>`,
            rogue: `<path d="M35 20 L50 80" stroke="${colors.accent}" stroke-width="2"/><path d="M65 20 L50 80" stroke="${colors.accent}" stroke-width="2"/><circle cx="50" cy="45" r="10" fill="none" stroke="${colors.accent}" stroke-width="1.5"/>`,
            cleric: `<path d="M50 18 L50 82" stroke="${colors.accent}" stroke-width="3"/><path d="M30 42 L70 42" stroke="${colors.accent}" stroke-width="3"/><circle cx="50" cy="42" r="18" fill="none" stroke="${colors.accent}" stroke-width="1.5"/>`,
            ranger: `<path d="M50 15 L50 70" stroke="${colors.accent}" stroke-width="2.5"/><path d="M30 35 L50 18 L70 35" fill="none" stroke="${colors.accent}" stroke-width="2.5"/><path d="M40 75 L50 88 L60 75" fill="none" stroke="${colors.accent}" stroke-width="2"/>`,
            paladin: `<path d="M32 22 L50 15 L68 22 L68 60 L50 80 L32 60 Z" fill="none" stroke="${colors.accent}" stroke-width="2.5"/><path d="M50 35 L50 60" stroke="${colors.accent}" stroke-width="2"/><path d="M40 47 L60 47" stroke="${colors.accent}" stroke-width="2"/>`,
            barbarian: `<path d="M25 75 L50 15 L75 75" fill="none" stroke="${colors.accent}" stroke-width="3"/><path d="M32 55 L68 55" stroke="${colors.accent}" stroke-width="2.5"/>`,
            bard: `<ellipse cx="50" cy="58" rx="18" ry="24" fill="none" stroke="${colors.accent}" stroke-width="2"/><path d="M68 58 L68 22 L75 15" fill="none" stroke="${colors.accent}" stroke-width="2.5"/><circle cx="42" cy="52" r="2" fill="${colors.accent}"/><circle cx="50" cy="50" r="2" fill="${colors.accent}"/><circle cx="58" cy="52" r="2" fill="${colors.accent}"/>`,
            druid: `<circle cx="50" cy="50" r="28" fill="none" stroke="${colors.accent}" stroke-width="1.5"/><path d="M50 22 Q70 42 50 50 Q30 42 50 22" fill="none" stroke="${colors.accent}" stroke-width="2"/><path d="M50 78 Q30 58 50 50 Q70 58 50 78" fill="none" stroke="${colors.accent}" stroke-width="2"/>`,
            monk: `<circle cx="50" cy="32" r="15" fill="none" stroke="${colors.accent}" stroke-width="2"/><circle cx="50" cy="32" r="7" fill="none" stroke="${colors.accent}" stroke-width="1.5"/><path d="M35 52 Q50 85 65 52" fill="none" stroke="${colors.accent}" stroke-width="2"/>`,
            warlock: `<path d="M50 12 L58 38 L85 42 L65 55 L72 82 L50 68 L28 82 L35 55 L15 42 L42 38 Z" fill="none" stroke="${colors.accent}" stroke-width="2"/><circle cx="50" cy="48" r="6" fill="${colors.accent}" opacity="0.4"/>`,
            sorcerer: `<circle cx="50" cy="50" r="30" fill="none" stroke="${colors.accent}" stroke-width="1" opacity="0.5"/><circle cx="50" cy="50" r="22" fill="none" stroke="${colors.accent}" stroke-width="1.5"/><circle cx="50" cy="50" r="12" fill="none" stroke="${colors.accent}" stroke-width="2"/><circle cx="50" cy="50" r="4" fill="${colors.accent}"/>`
        };
        
        const clsLower = (cls || '').toLowerCase();
        const symbol = classSymbols[clsLower] || classSymbols.warrior;
        
        // Race-specific decorative elements
        const raceDecor = {
            human: `<circle cx="50" cy="50" r="46" fill="none" stroke="${colors.primary}" stroke-width="3"/>`,
            elf: `<circle cx="50" cy="50" r="46" fill="none" stroke="${colors.primary}" stroke-width="2"/><path d="M50 4 Q62 18 50 24 Q38 18 50 4" fill="${colors.primary}" opacity="0.6"/><path d="M50 96 Q62 82 50 76 Q38 82 50 96" fill="${colors.primary}" opacity="0.6"/>`,
            dwarf: `<circle cx="50" cy="50" r="46" fill="none" stroke="${colors.primary}" stroke-width="5"/><circle cx="50" cy="50" r="41" fill="none" stroke="${colors.secondary}" stroke-width="1.5"/>`,
            halfling: `<circle cx="50" cy="50" r="46" fill="none" stroke="${colors.primary}" stroke-width="2.5" stroke-dasharray="10 5"/>`,
            gnome: `<circle cx="50" cy="50" r="46" fill="none" stroke="${colors.primary}" stroke-width="2"/><circle cx="50" cy="50" r="42" fill="none" stroke="${colors.accent}" stroke-width="1" opacity="0.4"/>`,
            orc: `<circle cx="50" cy="50" r="46" fill="none" stroke="${colors.primary}" stroke-width="4"/><path d="M18 25 L8 15" stroke="${colors.primary}" stroke-width="4"/><path d="M82 25 L92 15" stroke="${colors.primary}" stroke-width="4"/>`,
            tiefling: `<circle cx="50" cy="50" r="46" fill="none" stroke="${colors.primary}" stroke-width="2.5"/><path d="M22 12 Q15 0 28 5 Q22 10 22 12" fill="${colors.primary}"/><path d="M78 12 Q85 0 72 5 Q78 10 78 12" fill="${colors.primary}"/>`,
            dragonborn: `<circle cx="50" cy="50" r="46" fill="none" stroke="${colors.primary}" stroke-width="3"/><path d="M50 4 L56 14 L50 10 L44 14 Z" fill="${colors.primary}"/><path d="M50 96 L56 86 L50 90 L44 86 Z" fill="${colors.primary}"/>`
        };
        const decor = raceDecor[race] || raceDecor.human;
        
        return `<div class="character-portrait"><div class="portrait-frame" style="background: radial-gradient(circle at 30% 30%, ${colors.secondary}, #0d0b0e); border-color: ${colors.primary};"><svg class="portrait-svg" viewBox="0 0 100 100"><defs><radialGradient id="glow${uid}" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="${colors.accent}" stop-opacity="0.2"/><stop offset="100%" stop-color="${colors.accent}" stop-opacity="0"/></radialGradient></defs><circle cx="50" cy="50" r="38" fill="url(#glow${uid})"/>${decor}${symbol}</svg></div></div>`;
    }
    
    function generatePortraitSmall(race, cls) {
        const uid = Math.random().toString(36).substr(2, 9);
        const raceColors = {
            human: { primary: '#c9a86c', secondary: '#8b7355', accent: '#d4a857' },
            elf: { primary: '#7da88e', secondary: '#4a6b5a', accent: '#a8d4b8' },
            dwarf: { primary: '#a67c52', secondary: '#5c4033', accent: '#d4a857' },
            halfling: { primary: '#c9a86c', secondary: '#6b8e4e', accent: '#e8c47c' },
            gnome: { primary: '#b48be0', secondary: '#6b4a8e', accent: '#d4b8e8' },
            orc: { primary: '#4a6b3a', secondary: '#2d3d25', accent: '#8bc45d' },
            tiefling: { primary: '#8b3a3a', secondary: '#4a1f1f', accent: '#c45d5d' },
            dragonborn: { primary: '#3a5a8b', secondary: '#1f2f4a', accent: '#5d8bc4' }
        };
        const colors = raceColors[race] || raceColors.human;
        const clsLower = (cls || '').toLowerCase();
        
        // Simplified class symbols for small size
        const symbols = {
            warrior: `<path d="M50 20 L50 80 M35 35 L65 35" stroke="${colors.accent}" stroke-width="4"/>`,
            mage: `<path d="M50 18 L54 45 L78 50 L54 55 L50 82 L46 55 L22 50 L46 45 Z" fill="none" stroke="${colors.accent}" stroke-width="2.5"/>`,
            rogue: `<path d="M38 22 L50 78 M62 22 L50 78" stroke="${colors.accent}" stroke-width="3"/>`,
            cleric: `<path d="M50 20 L50 80 M30 45 L70 45" stroke="${colors.accent}" stroke-width="4"/>`,
            ranger: `<path d="M50 15 L50 70 M32 38 L50 20 L68 38" fill="none" stroke="${colors.accent}" stroke-width="3.5"/>`,
            paladin: `<path d="M32 25 L50 18 L68 25 L68 58 L50 78 L32 58 Z" fill="none" stroke="${colors.accent}" stroke-width="3"/>`,
            barbarian: `<path d="M25 75 L50 18 L75 75 M32 52 L68 52" fill="none" stroke="${colors.accent}" stroke-width="4"/>`,
            bard: `<ellipse cx="50" cy="58" rx="18" ry="24" fill="none" stroke="${colors.accent}" stroke-width="3"/><path d="M68 58 L68 25" stroke="${colors.accent}" stroke-width="3"/>`,
            druid: `<circle cx="50" cy="50" r="26" fill="none" stroke="${colors.accent}" stroke-width="2.5"/><path d="M50 24 Q68 44 50 50 Q32 44 50 24" fill="none" stroke="${colors.accent}" stroke-width="2.5"/>`,
            monk: `<circle cx="50" cy="35" r="16" fill="none" stroke="${colors.accent}" stroke-width="3"/><path d="M38 55 Q50 82 62 55" fill="none" stroke="${colors.accent}" stroke-width="2.5"/>`,
            warlock: `<path d="M50 12 L56 38 L82 42 L62 54 L68 80 L50 66 L32 80 L38 54 L18 42 L44 38 Z" fill="none" stroke="${colors.accent}" stroke-width="2.5"/>`,
            sorcerer: `<circle cx="50" cy="50" r="28" fill="none" stroke="${colors.accent}" stroke-width="2"/><circle cx="50" cy="50" r="18" fill="none" stroke="${colors.accent}" stroke-width="2.5"/><circle cx="50" cy="50" r="6" fill="${colors.accent}"/>`
        };
        const symbol = symbols[clsLower] || symbols.warrior;
        
        return `<div class="portrait-small" style="background: radial-gradient(circle at 30% 30%, ${colors.secondary}, #0d0b0e); border-color: ${colors.primary};"><svg viewBox="0 0 100 100"><defs><radialGradient id="gs${uid}" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="${colors.accent}" stop-opacity="0.2"/><stop offset="100%" stop-color="${colors.accent}" stop-opacity="0"/></radialGradient></defs><circle cx="50" cy="50" r="45" fill="url(#gs${uid})"/><circle cx="50" cy="50" r="46" fill="none" stroke="${colors.primary}" stroke-width="4"/>${symbol}</svg></div>`;
    }
    
    function adjustColor(hex, amt) {
        let c = hex.replace('#','');
        if (c.length === 3) c = c[0]+c[0]+c[1]+c[1]+c[2]+c[2];
        const num = parseInt(c, 16);
        let r = Math.min(255, Math.max(0, (num >> 16) + amt));
        let g = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + amt));
        let b = Math.min(255, Math.max(0, (num & 0x0000FF) + amt));
        return '#' + (0x1000000 + r * 0x10000 + g * 0x100 + b).toString(16).slice(1);
    }
    
    // ============ PDF CHARACTER SHEET EXPORT ============
    function generatePDF(char) {
        const pdf = `%PDF-1.4
1 0 obj << /Type /Catalog /Pages 2 0 R >> endobj
2 0 obj << /Type /Pages /Kids [3 0 R] /Count 1 >> endobj
3 0 obj << /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Contents 4 0 R /Resources << /Font << /F1 5 0 R /F2 6 0 R >> >> >> endobj
4 0 obj << /Length 1500 >>
stream
BT
/F1 24 Tf 50 720 Td (${char.name}) Tj
/F2 14 Tf 0 -30 Td (${char.gender} ${char.race} ${char.cls}) Tj
/F1 12 Tf 0 -40 Td (CHARACTER DETAILS) Tj
/F2 11 Tf 0 -20 Td (Race: ${char.race}) Tj 0 -16 Td (Class: ${char.cls}) Tj 0 -16 Td (Weapon: ${char.wep}) Tj 0 -16 Td (Trait: ${char.trait}) Tj
/F1 12 Tf 0 -35 Td (BACKSTORY) Tj
/F2 10 Tf 0 -18 Td (${wrapText(char.back, 80).slice(0,15).join(') Tj 0 -14 Td (')}) Tj
0 -40 Td (Generated by MythicNames.io) Tj
ET
endstream
endobj
5 0 obj << /Type /Font /Subtype /Type1 /BaseFont /Helvetica-Bold >> endobj
6 0 obj << /Type /Font /Subtype /Type1 /BaseFont /Helvetica >> endobj
xref
0 7
0000000000 65535 f 
0000000009 00000 n 
0000000058 00000 n 
0000000115 00000 n 
0000000266 00000 n 
0000001820 00000 n 
0000001897 00000 n 
trailer << /Size 7 /Root 1 0 R >>
startxref
1970
%%EOF`;
        return pdf;
    }
    
    function wrapText(text, maxLen) {
        const words = text.replace(/\n/g, ' ').split(' ');
        const lines = [];
        let line = '';
        words.forEach(w => {
            if ((line + ' ' + w).length > maxLen) { lines.push(line.trim()); line = w; }
            else { line += ' ' + w; }
        });
        if (line.trim()) lines.push(line.trim());
        return lines;
    }
    
    function downloadPDF() {
        if (!currentBackstoryData) { showToast('Generate a character first'); return; }
        const char = currentBackstoryData;
        
        // Create a cleaner PDF using HTML to PDF approach
        const content = `
        <html><head><style>
            body{font-family:Georgia,serif;padding:40px;max-width:600px;margin:0 auto}
            h1{color:#8b4513;border-bottom:2px solid #d4a857;padding-bottom:10px}
            h2{color:#5d4e37;margin-top:25px;font-size:14px;text-transform:uppercase;letter-spacing:2px}
            .subtitle{color:#666;font-style:italic;margin-bottom:20px}
            .stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin:15px 0}
            .stat{background:#f5f0e6;padding:8px 12px;border-left:3px solid #d4a857}
            .stat-label{font-size:11px;color:#888;text-transform:uppercase}
            .stat-value{font-weight:bold}
            .backstory{line-height:1.8;text-align:justify}
            .footer{margin-top:40px;padding-top:20px;border-top:1px solid #ddd;font-size:11px;color:#999;text-align:center}
        </style></head><body>
            <h1>${esc(char.name)}</h1>
            <p class="subtitle">${char.gender} ${char.race} ${char.cls}</p>
            <h2>Character Details</h2>
            <div class="stats">
                <div class="stat"><div class="stat-label">Race</div><div class="stat-value">${char.race}</div></div>
                <div class="stat"><div class="stat-label">Class</div><div class="stat-value">${char.cls}</div></div>
                <div class="stat"><div class="stat-label">Weapon</div><div class="stat-value">${char.wep}</div></div>
                <div class="stat"><div class="stat-label">Trait</div><div class="stat-value">${char.trait}</div></div>
            </div>
            <h2>Backstory</h2>
            <div class="backstory">${char.back.split('\n\n').map(p => '<p>' + esc(p) + '</p>').join('')}</div>
            <div class="footer">Generated by MythicNames.io</div>
        </body></html>`;
        
        const blob = new Blob([content], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const printWindow = window.open(url, '_blank');
        printWindow.onload = () => {
            printWindow.print();
            URL.revokeObjectURL(url);
        };
        showToast('Opening print dialog for PDF...');
    }
    
    // ============ EVENT HANDLERS ============
    function showSkeletons(count = 5) {
        const cont = document.getElementById('resultsContainer');
        cont.innerHTML = '<div class="names-list">' + Array(count).fill(0).map(() => `
            <div class="skeleton-card">
                <div class="skeleton skeleton-name"></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-text short"></div>
            </div>
        `).join('') + '</div>';
    }
    
    function showCharacterSkeleton() {
        const cont = document.getElementById('characterOutput');
        cont.innerHTML = `<div class="skeleton-card" style="text-align:center;padding:2rem">
            <div class="skeleton skeleton-avatar"></div>
            <div class="skeleton skeleton-name" style="margin:0 auto 1rem;width:50%"></div>
            <div class="skeleton skeleton-text" style="width:30%;margin:0 auto 1rem"></div>
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text"></div>
            <div class="skeleton skeleton-text short" style="margin:0 auto"></div>
        </div>`;
    }
    
    function handleGenerate() {
        const btn = document.getElementById('generateBtn');
        btn.classList.add('loading');
        btn.disabled = true;
        const count = parseInt(document.getElementById('count').value);
        showSkeletons(count);
        
        setTimeout(() => {
            const names = genNames({
                cat: document.getElementById('category').value,
                style: document.getElementById('style').value,
                gender: document.getElementById('gender').value,
                length: document.getElementById('length').value,
                count: count,
                classType: document.getElementById('classType').value,
                keywords: document.getElementById('keywords').value
            });
            displayNames(names);
            btn.classList.remove('loading');
            btn.disabled = false;
        }, 300);
    }
    
    // ============ INIT ============
    document.addEventListener('DOMContentLoaded', () => {
        // Tab switching
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const tabName = btn.dataset.tab;
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById('tab-' + tabName).classList.add('active');
                if (tabName === 'history') renderHistory();
                if (tabName === 'campaign') renderCampaigns();
            });
        });
        
        // Main generator
        document.getElementById('generateBtn').addEventListener('click', handleGenerate);
        document.getElementById('copyAllBtn').addEventListener('click', copyAll);
        document.getElementById('keywords').addEventListener('keypress', e => { if (e.key === 'Enter') handleGenerate(); });
        
        // Party generator
        document.getElementById('generatePartyBtn').addEventListener('click', generateParty);
        
        // World builder
        document.getElementById('generateWorldBtn').addEventListener('click', generateWorld);
        
        // Race generator
        let selectedRace = 'elf';
        document.querySelectorAll('.race-card').forEach(card => {
            card.addEventListener('click', () => {
                document.querySelectorAll('.race-card').forEach(c => c.classList.remove('active'));
                card.classList.add('active');
                selectedRace = card.dataset.race;
            });
        });
        document.querySelector('.race-card').classList.add('active');
        
        document.getElementById('generateRaceBtn').addEventListener('click', () => {
            const gender = document.getElementById('raceGender').value;
            const count = parseInt(document.getElementById('raceCount').value);
            const names = [];
            for (let i = 0; i < count; i++) {
                const name = raceName(selectedRace, gender);
                const rd = D.races[selectedRace];
                names.push({name, pron: pron(name), mean: '"' + r(rd.meanings) + '"', backstory: genBackstoryForName(name)});
                addToHistory(name);
            }
            displayNames(names, document.getElementById('raceResults'));
        });
        
        // Pack generator
        document.querySelectorAll('.pack-card').forEach(card => {
            card.addEventListener('click', () => {
                const pack = card.dataset.pack;
                const names = [];
                const count = 8;
                for (let i = 0; i < count; i++) {
                    let name = baseName('fantasy', 'any') + ' ' + lastName('fantasy');
                    if (pack === 'villains') name += ' the ' + r(['Dread','Terrible','Dark','Cruel','Vile']);
                    if (pack === 'heroes') name += ' the ' + r(['Brave','Bold','Valiant','Noble','True']);
                    if (pack === 'royalty') name = r(['King','Queen','Prince','Princess','Duke']) + ' ' + name.split(' ')[0];
                    names.push({name, pron: pron(name), mean: '"' + getMeaning('fantasy') + '"', backstory: genBackstoryForName(name)});
                    addToHistory(name);
                }
                displayNames(names, document.getElementById('packResults'));
            });
        });
        
        // Character creator
        document.getElementById('generateCharBtn').addEventListener('click', () => {
            // Show skeleton immediately
            document.getElementById('characterContainer').innerHTML = `<div class="skeleton-card" style="text-align:center;padding:2rem">
                <div class="skeleton skeleton-avatar" style="width:120px;height:120px;margin:0 auto 1rem"></div>
                <div class="skeleton skeleton-name" style="margin:0 auto 0.5rem;width:50%"></div>
                <div class="skeleton skeleton-text" style="width:30%;margin:0 auto 1rem"></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-text"></div>
                <div class="skeleton skeleton-text short" style="margin:0 auto"></div>
            </div>`;
            
            setTimeout(() => {
            const races = ['human','elf','dwarf','halfling','gnome','tiefling','dragonborn'];
            const classes = Object.keys(D.cls);
            const rc = document.getElementById('charRace').value === 'random' ? r(races) : document.getElementById('charRace').value;
            const cl = document.getElementById('charClass').value === 'random' ? r(classes) : document.getElementById('charClass').value;
            const gn = document.getElementById('charGender').value === 'random' ? r(['masculine','feminine']) : document.getElementById('charGender').value;
            
            const name = raceName(rc, gn) + ' ' + lastName('fantasy');
            const char = genBackstoryForName(name);
            char.race = cap(rc);
            char.cls = cap(cl);
            char.gender = cap(gn);
            
            const cd = D.cls[cl];
            char.wep = cap(r(cd.wep));
            char.trait = cap(r(cd.tr));
            
            addToHistory(name);
            
            const cont = document.getElementById('characterContainer');
            const factionHtml = char.faction ? `<div class="stat-item"><div class="stat-label">Faction</div><div class="stat-value">${char.faction.name}</div></div><div class="stat-item"><div class="stat-label">Role</div><div class="stat-value">${char.faction.role}</div></div>` : '';
            const portraitHtml = generatePortrait(char.race.toLowerCase(), char.cls, char.gender);
            const backstoryParagraphs = char.back.split(/\n\n+/).filter(p => p.trim()).map(p => '<p>' + esc(p.trim()) + '</p>').join('');
            cont.innerHTML = `<div class="character-card">${portraitHtml}<h3>${esc(char.name)}</h3><div class="character-subtitle">${char.gender} ${char.race} ${char.cls}</div><div class="character-stats"><div class="stat-item"><div class="stat-label">Race</div><div class="stat-value">${char.race}</div></div><div class="stat-item"><div class="stat-label">Class</div><div class="stat-value">${char.cls}</div></div><div class="stat-item"><div class="stat-label">Weapon</div><div class="stat-value">${char.wep}</div></div><div class="stat-item"><div class="stat-label">Trait</div><div class="stat-value">${char.trait}</div></div>${factionHtml}</div><div class="character-backstory">${backstoryParagraphs}</div><div class="character-actions"><button class="secondary-btn" onclick="copyCharacter()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>Copy</button><button class="secondary-btn" onclick="downloadPDF()">üìÑ PDF</button><button class="secondary-btn" onclick="addToCampaign('character', currentBackstoryData)">üìö Save</button><button class="secondary-btn" onclick="openShareCard(currentBackstoryData)">üñºÔ∏è Card</button><button class="share-btn twitter" onclick="shareTwitter()"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>Tweet</button><button class="generate-btn" onclick="document.getElementById('generateCharBtn').click()">Generate Another</button></div></div>`;
            
            currentBackstoryData = char;
            }, 400); // end setTimeout
        });
        
        // Modal close handlers
        document.getElementById('backstoryModal').addEventListener('click', e => { if (e.target.id === 'backstoryModal') closeModal(); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
        
        // Init history badge
        updateHistoryBadge();
    });
    
    async function copyCharacter() {
        const card = document.querySelector('.character-card');
        if (!card) return;
        const name = card.querySelector('h3').textContent;
        const subtitle = card.querySelector('.character-subtitle').textContent;
        const stats = Array.from(card.querySelectorAll('.stat-item')).map(s => s.querySelector('.stat-label').textContent + ': ' + s.querySelector('.stat-value').textContent).join('\n');
        const backstory = Array.from(card.querySelectorAll('.character-backstory p')).map(p => p.textContent).join('\n\n');
        const t = '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n' + name.toUpperCase() + '\n' + subtitle + '\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n' + stats + '\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nBACKSTORY\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n' + backstory;
        try { await navigator.clipboard.writeText(t); showToast('Character copied!'); } catch(e) {}
    }
    
    // ============ EASTER EGGS ============
    
    // 1. Konami Code: ‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA - Legendary Mode
    let konamiSequence = [];
    const konamiCode = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','KeyB','KeyA'];
    let legendaryMode = false;
    
    document.addEventListener('keydown', (e) => {
        konamiSequence.push(e.code);
        konamiSequence = konamiSequence.slice(-10);
        if (konamiSequence.join(',') === konamiCode.join(',')) {
            activateLegendaryMode();
        }
    });
    
    function activateLegendaryMode() {
        if (legendaryMode) return;
        legendaryMode = true;
        
        // Epic visual effect
        document.body.style.transition = 'all 0.5s';
        const flash = document.createElement('div');
        flash.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle,rgba(212,168,87,0.8),transparent);z-index:9999;pointer-events:none;animation:legendaryFlash 1.5s forwards';
        document.body.appendChild(flash);
        
        // Add legendary particles
        for (let i = 0; i < 50; i++) {
            setTimeout(() => {
                const particle = document.createElement('div');
                particle.className = 'legendary-particle';
                particle.style.cssText = `position:fixed;width:8px;height:8px;background:gold;border-radius:50%;pointer-events:none;z-index:9998;left:${Math.random()*100}%;top:100%;box-shadow:0 0 10px gold,0 0 20px orange;animation:legendaryRise ${3+Math.random()*2}s forwards`;
                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 5000);
            }, i * 50);
        }
        
        // Show toast
        showToast('‚öîÔ∏è LEGENDARY MODE ACTIVATED! ‚öîÔ∏è');
        
        // Add legendary badge to logo
        const logo = document.querySelector('.logo');
        if (logo) {
            logo.innerHTML += ' <span style="color:#ffd700;text-shadow:0 0 10px gold;font-size:0.6em;">‚öúÔ∏è LEGENDARY ‚öúÔ∏è</span>';
        }
        
        setTimeout(() => flash.remove(), 1500);
    }
    
    // Add CSS for legendary effects
    const legendaryStyles = document.createElement('style');
    legendaryStyles.textContent = `
        @keyframes legendaryFlash{0%{opacity:0}20%{opacity:1}100%{opacity:0}}
        @keyframes legendaryRise{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(-120vh) rotate(720deg);opacity:0}}
        .legendary-particle{animation-timing-function:ease-out}
    `;
    document.head.appendChild(legendaryStyles);
    
    // 2. Secret Name Easter Eggs
    const secretNameResponses = {
        'gandalf': { toast: 'üßô A wizard is never late...', name: 'Mithrandir the Grey Wanderer' },
        'frodo': { toast: 'üíç Keep it secret, keep it safe...', name: 'Baggins the Ringbearer' },
        'aragorn': { toast: 'üëë The king has returned!', name: 'Strider of the D√∫nedain' },
        'legolas': { toast: 'üèπ They\'re taking the hobbits to Isengard!', name: 'Greenleaf of the Woodland Realm' },
        'gimli': { toast: '‚õèÔ∏è And my axe!', name: 'Son of Gl√≥in, Dwarf-lord' },
        'sauron': { toast: 'üëÅÔ∏è One ring to rule them all...', name: 'The Dark Lord of Mordor' },
        'conan': { toast: '‚öîÔ∏è What is best in life?', name: 'The Cimmerian Barbarian' },
        'drizzt': { toast: 'üó°Ô∏è The legend of the dark elf!', name: 'Do\'Urden of Menzoberranzan' },
        'elminster': { toast: 'üìö The Sage of Shadowdale approves!', name: 'Aumar the Mage of Mysteries' },
        'raistlin': { toast: '‚è≥ The hourglass eyes see all...', name: 'Majere of the Black Robes' },
        'tanis': { toast: 'üå≤ Half-elven, half-human, full hero!', name: 'Half-Elven of Qualinost' },
        'geralt': { toast: 'üê∫ Toss a coin to your Witcher!', name: 'of Rivia, The White Wolf' },
        'bilbo': { toast: 'üè† In a hole in the ground...', name: 'Baggins of Bag End' }
    };
    
    // Hook into name generation to check for secret names
    const originalGenerateNames = window.generateNames;
    if (typeof generateNames === 'function') {
        const _origGen = generateNames;
        // We'll check backstory text input if it exists
    }
    
    // Check for secret names in any text input
    document.addEventListener('input', (e) => {
        if (e.target.tagName === 'INPUT' && e.target.type === 'text') {
            const val = e.target.value.toLowerCase().trim();
            if (secretNameResponses[val]) {
                const secret = secretNameResponses[val];
                showToast(secret.toast);
            }
        }
    });
    
    // 3. Logo Click Counter - Click 7 times for dragon
    let logoClicks = 0;
    let logoClickTimer = null;
    const logoWrapper = document.querySelector('.logo-wrapper');
    
    if (logoWrapper) {
        logoWrapper.style.cursor = 'pointer';
        logoWrapper.addEventListener('click', () => {
            logoClicks++;
            clearTimeout(logoClickTimer);
            
            if (logoClicks >= 7) {
                triggerDragonEasterEgg();
                logoClicks = 0;
            } else {
                logoClickTimer = setTimeout(() => logoClicks = 0, 2000);
            }
        });
    }
    
    function triggerDragonEasterEgg() {
        showToast('üêâ You have awakened the dragon!');
        
        const dragon = document.createElement('div');
        dragon.innerHTML = 'üêâ';
        dragon.style.cssText = 'position:fixed;font-size:80px;z-index:9999;pointer-events:none;left:-100px;top:30%;filter:drop-shadow(0 0 20px orange);animation:dragonFly 4s forwards ease-in-out';
        document.body.appendChild(dragon);
        
        // Add fire breath particles
        setTimeout(() => {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const fire = document.createElement('div');
                    fire.innerHTML = 'üî•';
                    fire.style.cssText = `position:fixed;font-size:${20+Math.random()*30}px;z-index:9998;pointer-events:none;left:${50+Math.random()*30}%;top:${25+Math.random()*20}%;opacity:0;animation:fireBreath 1s forwards`;
                    document.body.appendChild(fire);
                    setTimeout(() => fire.remove(), 1000);
                }, i * 100);
            }
        }, 1500);
        
        setTimeout(() => dragon.remove(), 4000);
    }
    
    // Add dragon animation CSS
    const dragonStyles = document.createElement('style');
    dragonStyles.textContent = `
        @keyframes dragonFly{
            0%{left:-100px;transform:scaleX(1) rotate(-10deg)}
            45%{top:25%;transform:scaleX(1) rotate(5deg)}
            50%{transform:scaleX(1) rotate(0deg)}
            55%{top:35%;transform:scaleX(1) rotate(-5deg)}
            100%{left:calc(100% + 100px);transform:scaleX(1) rotate(10deg)}
        }
        @keyframes fireBreath{
            0%{opacity:0;transform:scale(0.5)}
            50%{opacity:1;transform:scale(1.2)}
            100%{opacity:0;transform:scale(0.3) translateY(-50px)}
        }
    `;
    document.head.appendChild(dragonStyles);
    
    // 5. Secret "Goblin Programmer" Class - Gnome + Rogue + click trait label 3 times
    let traitClicks = 0;
    let traitClickTimer = null;
    
    document.addEventListener('click', (e) => {
        if (e.target.tagName === 'LABEL' && e.target.textContent.includes('Trait')) {
            const raceSelect = document.getElementById('charRace');
            const classSelect = document.getElementById('charClass');
            
            if (raceSelect?.value === 'gnome' && classSelect?.value === 'rogue') {
                traitClicks++;
                clearTimeout(traitClickTimer);
                
                if (traitClicks >= 3) {
                    unlockGoblinProgrammer();
                    traitClicks = 0;
                } else {
                    traitClickTimer = setTimeout(() => traitClicks = 0, 2000);
                }
            }
        }
    });
    
    let goblinProgrammerUnlocked = false;
    function unlockGoblinProgrammer() {
        if (goblinProgrammerUnlocked) return;
        goblinProgrammerUnlocked = true;
        
        showToast('üñ•Ô∏è SECRET CLASS UNLOCKED: Goblin Programmer!');
        
        // Add to class select
        const classSelect = document.getElementById('charClass');
        if (classSelect) {
            const option = document.createElement('option');
            option.value = 'programmer';
            option.textContent = 'üñ•Ô∏è Goblin Programmer';
            option.style.color = '#00ff00';
            classSelect.appendChild(option);
            classSelect.value = 'programmer';
        }
        
        // Add programmer-specific traits and weapons to the generation
        window.programmerTraits = ['Caffeine-dependent', 'Bug-obsessed', 'Stack Overflow devotee', 'Keyboard warrior', 'Rubber duck whisperer', 'Merge conflict survivor', 'Tab vs Space zealot', 'Legacy code archaeologist'];
        window.programmerWeapons = ['Mechanical Keyboard of Clacking', 'Mouse of Infinite Clicks', 'USB Cable of Debugging', 'Monitor of Blue Light', 'Coffee Mug of Endless Refills', 'Rubber Duck of Wisdom'];
    }
    
    // 6. D20 Roll - Press D, 2, 0 in sequence
    let d20Sequence = [];
    document.addEventListener('keydown', (e) => {
        if (['KeyD', 'Digit2', 'Digit0'].includes(e.code)) {
            d20Sequence.push(e.code);
            d20Sequence = d20Sequence.slice(-3);
            
            if (d20Sequence.join(',') === 'KeyD,Digit2,Digit0') {
                rollD20();
                d20Sequence = [];
            }
        }
    });
    
    function rollD20() {
        const result = Math.floor(Math.random() * 20) + 1;
        
        const overlay = document.createElement('div');
        overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);z-index:10000;display:flex;align-items:center;justify-content:center;flex-direction:column;animation:fadeIn 0.3s';
        
        const dice = document.createElement('div');
        dice.style.cssText = 'font-size:120px;animation:diceRoll 1s ease-out';
        dice.textContent = 'üé≤';
        
        const resultText = document.createElement('div');
        resultText.style.cssText = 'font-size:72px;font-family:Cinzel,serif;margin-top:20px;opacity:0;animation:resultReveal 0.5s 0.8s forwards';
        
        let resultColor = '#fff';
        let resultMessage = '';
        if (result === 20) {
            resultColor = '#ffd700';
            resultMessage = 'CRITICAL SUCCESS!';
        } else if (result === 1) {
            resultColor = '#ff4444';
            resultMessage = 'CRITICAL FAIL!';
        } else if (result >= 15) {
            resultColor = '#88ff88';
            resultMessage = 'Great roll!';
        } else if (result <= 5) {
            resultColor = '#ffaa44';
            resultMessage = 'Oof...';
        }
        
        resultText.innerHTML = `<span style="color:${resultColor};text-shadow:0 0 20px ${resultColor}">${result}</span><br><span style="font-size:24px;color:var(--text-secondary)">${resultMessage}</span>`;
        
        overlay.appendChild(dice);
        overlay.appendChild(resultText);
        document.body.appendChild(overlay);
        
        overlay.addEventListener('click', () => overlay.remove());
        setTimeout(() => overlay.remove(), 4000);
        
        showToast(`üé≤ You rolled a ${result}!`);
    }
    
    // Add D20 animation CSS
    const d20Styles = document.createElement('style');
    d20Styles.textContent = `
        @keyframes diceRoll{
            0%{transform:rotate(0deg) scale(0.5);opacity:0}
            25%{transform:rotate(180deg) scale(1.2)}
            50%{transform:rotate(360deg) scale(0.9)}
            75%{transform:rotate(540deg) scale(1.1)}
            100%{transform:rotate(720deg) scale(1);opacity:1}
        }
        @keyframes resultReveal{
            0%{opacity:0;transform:scale(0.5)}
            50%{transform:scale(1.2)}
            100%{opacity:1;transform:scale(1)}
        }
    `;
    document.head.appendChild(d20Styles);
    
    // 7. Right-click logo sword - Pull sword from stone mini-game
    const logoIcon = document.querySelector('.logo-icon');
    if (logoIcon) {
        logoIcon.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            startSwordGame();
        });
    }
    
    let swordPulls = 0;
    function startSwordGame() {
        swordPulls = 0;
        
        const overlay = document.createElement('div');
        overlay.id = 'swordGame';
        overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:10000;display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:pointer';
        
        overlay.innerHTML = `
            <div style="font-size:24px;color:var(--text-secondary);margin-bottom:20px">Click rapidly to pull the sword!</div>
            <div style="position:relative;font-size:100px">
                <div id="swordStone" style="position:relative">ü™®</div>
                <div id="swordBlade" style="position:absolute;top:-60px;left:50%;transform:translateX(-50%);transition:top 0.1s">‚öîÔ∏è</div>
            </div>
            <div id="swordProgress" style="width:300px;height:20px;background:#333;border-radius:10px;margin-top:30px;overflow:hidden">
                <div id="swordProgressBar" style="width:0%;height:100%;background:linear-gradient(90deg,#d4a857,#ffd700);transition:width 0.1s"></div>
            </div>
            <div id="swordCount" style="color:var(--accent-gold);font-size:18px;margin-top:10px">0 / 20 pulls</div>
            <div style="color:var(--text-faded);font-size:14px;margin-top:20px">Press ESC to close</div>
        `;
        
        document.body.appendChild(overlay);
        
        const blade = document.getElementById('swordBlade');
        const progressBar = document.getElementById('swordProgressBar');
        const countText = document.getElementById('swordCount');
        
        overlay.addEventListener('click', () => {
            swordPulls++;
            const progress = Math.min((swordPulls / 20) * 100, 100);
            progressBar.style.width = progress + '%';
            countText.textContent = `${swordPulls} / 20 pulls`;
            
            // Sword moves up slightly with each click
            blade.style.top = (-60 - swordPulls * 3) + 'px';
            
            if (swordPulls >= 20) {
                // Success!
                blade.style.top = '-200px';
                blade.style.transition = 'top 0.5s ease-out';
                blade.style.transform = 'translateX(-50%) scale(1.5)';
                
                setTimeout(() => {
                    overlay.innerHTML = `
                        <div style="font-size:80px;animation:popIn 0.5s">üëë</div>
                        <div style="font-size:36px;color:#ffd700;font-family:Cinzel,serif;margin-top:20px;text-shadow:0 0 20px gold">THE SWORD IS YOURS!</div>
                        <div style="font-size:18px;color:var(--text-secondary);margin-top:10px">You are the true ruler!</div>
                    `;
                    showToast('üëë You pulled the sword from the stone!');
                    
                    // Unlock a special title
                    if (!legendaryMode) {
                        const logo = document.querySelector('.logo');
                        if (logo && !logo.innerHTML.includes('TRUE RULER')) {
                            logo.innerHTML += ' <span style="color:#ffd700;font-size:0.5em;">üëë</span>';
                        }
                    }
                }, 500);
                
                setTimeout(() => overlay.remove(), 3000);
            }
        });
        
        document.addEventListener('keydown', function escHandler(e) {
            if (e.key === 'Escape') {
                overlay.remove();
                document.removeEventListener('keydown', escHandler);
            }
        });
    }
    
    // 8. Rick Roll Easter Egg - 1 in 500 chance (made slightly more common for fun)
    const originalAddToHistory = window.addToHistory;
    const rickRollBackstory = `Rick Astley was born in a small tavern, where his voice could charm even the most hardened warriors. He swore an oath to never give up on his companions, never let them down, never run around and desert them. His legendary ballads have been known to make grown orcs weep and dragons dance. He travels the realm, spreading his message of eternal commitment and surprisingly catchy melodies. Some say if you hear his song three times, you'll never be able to get it out of your head. His signature move, the "Astley Shuffle," has been adopted by bards across all kingdoms.`;
    
    function checkForRickRoll(names) {
        if (Math.random() < 0.002) { // 1 in 500 chance
            const rickIndex = Math.floor(Math.random() * names.length);
            names[rickIndex] = {
                name: 'Rick Astley the Bard',
                pron: 'rik AST-lee',
                mean: 'Never gonna give you up',
                backstory: {
                    name: 'Rick Astley the Bard',
                    cls: 'Bard',
                    gender: 'Masculine',
                    wep: 'Microphone of Eternal Devotion',
                    trait: 'Never gives up',
                    back: rickRollBackstory,
                    faction: { name: 'The Rickrollers Guild', role: 'Supreme Bard' }
                }
            };
            setTimeout(() => showToast('üé§ You\'ve been rickrolled!'), 1000);
        }
        return names;
    }
    
    // Hook into displayNames to check for rickroll
    const _originalDisplayNames = displayNames;
    displayNames = function(names, cont) {
        names = checkForRickRoll(names);
        _originalDisplayNames(names, cont);
    };
    
    // Easter egg hint in console
    console.log('%cüéÆ MythicNames Easter Eggs Active!', 'color: gold; font-size: 16px; font-weight: bold;');
    console.log('%cHints: Konami Code, Click the logo, Right-click the sword, Try typing famous fantasy names, Press D-2-0...', 'color: #888; font-size: 12px;');
    </script>
</body>
</html>
